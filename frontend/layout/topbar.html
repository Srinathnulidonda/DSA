<nav class="topbar">
    <div class="d-flex align-items-center w-100">
        <button class="btn btn-link d-md-none" id="sidebar-toggle">
            <i class="bi bi-list fs-5"></i>
        </button>

        <a href="/pages/dashboard" class="topbar-brand">
            <i class="bi bi-code-square"></i>
            <span>DSAPath</span>
        </a>

        <div class="topbar-nav">
            <div class="d-none d-md-flex align-items-center me-3">
                <input type="search" class="form-control form-control-sm" placeholder="Search..." id="global-search"
                    style="width: 200px;">
            </div>

            <button class="btn btn-link position-relative" id="notifications-toggle">
                <i class="bi bi-bell"></i>
                <span class="badge bg-danger position-absolute top-0 start-100 translate-middle badge-pill"
                    id="notification-count" style="display: none;">0</span>
            </button>

            <button class="btn btn-link" data-theme-toggle>
                <i class="bi bi-moon"></i>
            </button>

            <div class="dropdown">
                <button class="btn btn-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown">
                    <img src="/assets/images/default-avatar.png" alt="Avatar" class="rounded-circle me-2" width="32"
                        height="32" id="user-avatar">
                    <span class="d-none d-md-inline" id="user-name">User</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="/pages/profile"><i class="bi bi-person me-2"></i>Profile</a></li>
                    <li><a class="dropdown-item" href="/pages/settings"><i class="bi bi-gear me-2"></i>Settings</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#" id="logout-btn"><i
                                class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<script>
    // Global search
    document.getElementById('global-search').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.target.value.trim()) {
            window.location.href = `/pages/search?q=${encodeURIComponent(e.target.value)}`;
        }
    });

    // Logout handler
    document.getElementById('logout-btn').addEventListener('click', (e) => {
        e.preventDefault();
        auth.clear();
        window.location.href = '/auth/login';
    });

    // Load notifications count
    (async () => {
        try {
            const response = await api.get('/notifications?per_page=1');
            const unreadCount = response.pagination.total;

            if (unreadCount > 0) {
                const badge = document.getElementById('notification-count');
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                badge.style.display = 'block';
            }
        } catch (error) {
            console.error('Failed to load notifications:', error);
        }
    })();
</script>