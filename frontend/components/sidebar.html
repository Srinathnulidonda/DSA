<!-- components/sidebar.html -->
<div id="sidebar" class="sidebar bg-white shadow-lg">
    <div class="sidebar-header p-4 border-bottom">
        <a href="/dashboard" class="text-decoration-none">
            <h4 class="mb-0 text-primary fw-bold">
                <i class="fas fa-code"></i> DSA Master
            </h4>
        </a>
    </div>

    <nav class="sidebar-nav p-3">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/dashboard" data-page="dashboard">
                    <i class="fas fa-home me-2"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/roadmap" data-page="roadmap">
                    <i class="fas fa-road me-2"></i>
                    <span>Roadmap</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/calendar" data-page="calendar">
                    <i class="fas fa-calendar me-2"></i>
                    <span>Calendar</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/progress" data-page="progress">
                    <i class="fas fa-chart-line me-2"></i>
                    <span>Progress</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/notes" data-page="notes">
                    <i class="fas fa-sticky-note me-2"></i>
                    <span>Notes</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/pomodoro" data-page="pomodoro">
                    <i class="fas fa-clock me-2"></i>
                    <span>Pomodoro</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/analytics" data-page="analytics">
                    <i class="fas fa-chart-bar me-2"></i>
                    <span>Analytics</span>
                </a>
            </li>
        </ul>

        <hr class="my-3">

        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link sidebar-link" href="/profile" data-page="profile">
                    <i class="fas fa-user me-2"></i>
                    <span>Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link sidebar-link text-danger" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-2"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="sidebar-footer p-3 border-top mt-auto">
        <div class="progress mb-2" style="height: 6px;">
            <div class="progress-bar bg-primary" id="sidebarProgress" style="width: 0%"></div>
        </div>
        <small class="text-muted">Overall Progress: <span id="sidebarProgressText">0%</span></small>
    </div>
</div>

<style>
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 260px;
        z-index: 1000;
        transition: transform 0.3s ease;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .sidebar-link {
        color: #6c757d;
        padding: 0.75rem 1rem;
        margin-bottom: 0.25rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
    }

    .sidebar-link:hover {
        background-color: #f8f9fa;
        color: #007bff;
    }

    .sidebar-link.active {
        background-color: #e7f1ff;
        color: #007bff;
        font-weight: 500;
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }

        .sidebar.show {
            transform: translateX(0);
        }
    }
</style>

<script>
    // Set active link based on current page
    const currentPath = window.location.pathname.replace('.html', '');
    document.querySelectorAll('.sidebar-link').forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === currentPath) {
            link.classList.add('active');
        }
    });

    // Update progress in sidebar
    async function updateSidebarProgress() {
        const token = localStorage.getItem('access_token');
        if (!token) return;

        try {
            const response = await fetch('https://dsa-backend-gj8n.onrender.com/dashboard', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                const progress = Math.round(data.stats.completion_percentage || 0);
                document.getElementById('sidebarProgress').style.width = `${progress}%`;
                document.getElementById('sidebarProgressText').textContent = `${progress}%`;
            }
        } catch (error) {
            console.error('Failed to update sidebar progress:', error);
        }
    }

    // Logout function
    function logout() {
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
        window.location.href = '/login';
    }

    // Update progress on load
    updateSidebarProgress();
</script>