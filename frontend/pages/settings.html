<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - DSA Path</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/components.css" rel="stylesheet">
    <link href="../css/animation.css" rel="stylesheet">
    <link href="../css/responsive.css" rel="stylesheet">
</head>

<body>
    <div class="main-layout">
        <!-- Include Sidebar -->
        <div id="sidebar-container"></div>

        <div class="main-content">
            <!-- Include Topbar -->
            <div id="topbar-container"></div>

            <div class="content-area">
                <!-- Header Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div
                            class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                            <div class="animate-fadeInLeft">
                                <h2 class="fw-bold text-dark mb-1">Settings</h2>
                                <p class="text-muted mb-0">Customize your learning experience</p>
                            </div>
                            <div class="d-flex gap-2 animate-fadeInRight">
                                <button class="btn btn-outline-primary btn-sm" onclick="exportSettings()">
                                    <i class="fas fa-download me-1"></i>Export
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="resetToDefaults()">
                                    <i class="fas fa-undo me-1"></i>Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Navigation -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="settings-nav-wrapper">
                            <ul class="nav nav-pills settings-nav" id="settings-nav" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="general-tab" data-bs-toggle="pill"
                                        data-bs-target="#general" type="button" role="tab">
                                        <i class="fas fa-cog me-2"></i>General
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="appearance-tab" data-bs-toggle="pill"
                                        data-bs-target="#appearance" type="button" role="tab">
                                        <i class="fas fa-palette me-2"></i>Appearance
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="notifications-tab" data-bs-toggle="pill"
                                        data-bs-target="#notifications" type="button" role="tab">
                                        <i class="fas fa-bell me-2"></i>Notifications
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="study-tab" data-bs-toggle="pill"
                                        data-bs-target="#study" type="button" role="tab">
                                        <i class="fas fa-book me-2"></i>Study
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="privacy-tab" data-bs-toggle="pill"
                                        data-bs-target="#privacy" type="button" role="tab">
                                        <i class="fas fa-shield-alt me-2"></i>Privacy
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Settings Content -->
                <div class="tab-content" id="settings-content">
                    <!-- General Settings -->
                    <div class="tab-pane fade show active" id="general" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="stats-card animate-fadeInUp">
                                    <h5 class="fw-bold mb-4">
                                        <i class="fas fa-cog me-2"></i>General Preferences
                                    </h5>

                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="form-group-custom">
                                                <label class="form-label-custom">Language</label>
                                                <select class="form-control-custom" id="language-select">
                                                    <option value="en">English</option>
                                                    <option value="es">Español</option>
                                                    <option value="fr">Français</option>
                                                    <option value="de">Deutsch</option>
                                                    <option value="it">Italiano</option>
                                                    <option value="pt">Português</option>
                                                    <option value="ru">Русский</option>
                                                    <option value="zh">中文</option>
                                                    <option value="ja">日本語</option>
                                                    <option value="ko">한국어</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group-custom">
                                                <label class="form-label-custom">Timezone</label>
                                                <select class="form-control-custom" id="timezone-select">
                                                    <option value="UTC">UTC (Coordinated Universal Time)</option>
                                                    <option value="America/New_York">Eastern Time (ET)</option>
                                                    <option value="America/Chicago">Central Time (CT)</option>
                                                    <option value="America/Denver">Mountain Time (MT)</option>
                                                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                                    <option value="Europe/London">London (GMT)</option>
                                                    <option value="Europe/Paris">Paris (CET)</option>
                                                    <option value="Europe/Moscow">Moscow (MSK)</option>
                                                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                                                    <option value="Asia/Shanghai">Shanghai (CST)</option>
                                                    <option value="Asia/Kolkata">India (IST)</option>
                                                    <option value="Australia/Sydney">Sydney (AEST)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-4 mt-3">
                                        <div class="col-md-6">
                                            <div class="form-group-custom">
                                                <label class="form-label-custom">Week Start Day</label>
                                                <select class="form-control-custom" id="week-start-select">
                                                    <option value="sunday">Sunday</option>
                                                    <option value="monday">Monday</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group-custom">
                                                <label class="form-label-custom">Date Format</label>
                                                <select class="form-control-custom" id="date-format-select">
                                                    <option value="MM/DD/YYYY">MM/DD/YYYY (US)</option>
                                                    <option value="DD/MM/YYYY">DD/MM/YYYY (UK)</option>
                                                    <option value="YYYY-MM-DD">YYYY-MM-DD (ISO)</option>
                                                    <option value="DD-MM-YYYY">DD-MM-YYYY</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-check form-switch mt-4">
                                        <input class="form-check-input" type="checkbox" id="auto-save-switch" checked>
                                        <label class="form-check-label fw-semibold" for="auto-save-switch">
                                            Auto-save notes and progress
                                        </label>
                                        <div class="form-text">Automatically save your work every few minutes</div>
                                    </div>

                                    <div class="form-check form-switch mt-3">
                                        <input class="form-check-input" type="checkbox" id="offline-mode-switch">
                                        <label class="form-check-label fw-semibold" for="offline-mode-switch">
                                            Enable offline mode
                                        </label>
                                        <div class="form-text">Cache content for offline access</div>
                                    </div>

                                    <div class="form-check form-switch mt-3">
                                        <input class="form-check-input" type="checkbox" id="analytics-switch" checked>
                                        <label class="form-check-label fw-semibold" for="analytics-switch">
                                            Help improve DSA Path
                                        </label>
                                        <div class="form-text">Send anonymous usage data to help us improve the platform
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="stats-card animate-fadeInUp animation-delay-100">
                                    <h6 class="fw-bold mb-3">Quick Actions</h6>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="clearCache()">
                                            <i class="fas fa-broom me-1"></i>Clear Cache
                                        </button>
                                        <button class="btn btn-outline-info btn-sm" onclick="downloadData()">
                                            <i class="fas fa-download me-1"></i>Download Data
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="importSettings()">
                                            <i class="fas fa-upload me-1"></i>Import Settings
                                        </button>
                                    </div>

                                    <hr class="my-4">

                                    <h6 class="fw-bold mb-3">Storage Usage</h6>
                                    <div class="storage-info">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Notes</span>
                                            <span class="text-muted" id="notes-storage">0 KB</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Progress Data</span>
                                            <span class="text-muted" id="progress-storage">0 KB</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Cache</span>
                                            <span class="text-muted" id="cache-storage">0 KB</span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total</span>
                                            <span id="total-storage">0 KB</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appearance Settings -->
                    <div class="tab-pane fade" id="appearance" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="stats-card animate-fadeInUp">
                                    <h5 class="fw-bold mb-4">
                                        <i class="fas fa-palette me-2"></i>Appearance & Layout
                                    </h5>

                                    <!-- Theme Selection -->
                                    <div class="theme-section mb-4">
                                        <h6 class="fw-semibold mb-3">Theme</h6>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="theme-option" data-theme="light">
                                                    <div class="theme-preview light-theme">
                                                        <div class="theme-header"></div>
                                                        <div class="theme-sidebar"></div>
                                                        <div class="theme-content"></div>
                                                    </div>
                                                    <div class="theme-info text-center mt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme"
                                                                id="light-theme" value="light" checked>
                                                            <label class="form-check-label fw-semibold"
                                                                for="light-theme">Light</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="theme-option" data-theme="dark">
                                                    <div class="theme-preview dark-theme">
                                                        <div class="theme-header"></div>
                                                        <div class="theme-sidebar"></div>
                                                        <div class="theme-content"></div>
                                                    </div>
                                                    <div class="theme-info text-center mt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme"
                                                                id="dark-theme" value="dark">
                                                            <label class="form-check-label fw-semibold"
                                                                for="dark-theme">Dark</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="theme-option" data-theme="auto">
                                                    <div class="theme-preview auto-theme">
                                                        <div class="theme-header"></div>
                                                        <div class="theme-sidebar"></div>
                                                        <div class="theme-content"></div>
                                                    </div>
                                                    <div class="theme-info text-center mt-2">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme"
                                                                id="auto-theme" value="auto">
                                                            <label class="form-check-label fw-semibold"
                                                                for="auto-theme">Auto</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Layout Options -->
                                    <div class="layout-section mb-4">
                                        <h6 class="fw-semibold mb-3">Layout</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Sidebar Width</label>
                                                    <select class="form-control-custom" id="sidebar-width-select">
                                                        <option value="compact">Compact (240px)</option>
                                                        <option value="default" selected>Default (280px)</option>
                                                        <option value="wide">Wide (320px)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Content Width</label>
                                                    <select class="form-control-custom" id="content-width-select">
                                                        <option value="fluid">Fluid (Full Width)</option>
                                                        <option value="container" selected>Container (1400px)</option>
                                                        <option value="narrow">Narrow (1200px)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Font & Text Settings -->
                                    <div class="typography-section mb-4">
                                        <h6 class="fw-semibold mb-3">Typography</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Font Family</label>
                                                    <select class="form-control-custom" id="font-family-select">
                                                        <option value="inter" selected>Inter (Default)</option>
                                                        <option value="roboto">Roboto</option>
                                                        <option value="open-sans">Open Sans</option>
                                                        <option value="lato">Lato</option>
                                                        <option value="source-sans">Source Sans Pro</option>
                                                        <option value="system">System Font</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Font Size</label>
                                                    <select class="form-control-custom" id="font-size-select">
                                                        <option value="small">Small (14px)</option>
                                                        <option value="default" selected>Default (16px)</option>
                                                        <option value="large">Large (18px)</option>
                                                        <option value="extra-large">Extra Large (20px)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Accessibility Options -->
                                    <div class="accessibility-section">
                                        <h6 class="fw-semibold mb-3">Accessibility</h6>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="high-contrast-switch">
                                            <label class="form-check-label fw-semibold" for="high-contrast-switch">
                                                High contrast mode
                                            </label>
                                            <div class="form-text">Increase contrast for better visibility</div>
                                        </div>

                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="reduce-motion-switch">
                                            <label class="form-check-label fw-semibold" for="reduce-motion-switch">
                                                Reduce motion
                                            </label>
                                            <div class="form-text">Minimize animations and transitions</div>
                                        </div>

                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="focus-indicators-switch"
                                                checked>
                                            <label class="form-check-label fw-semibold" for="focus-indicators-switch">
                                                Enhanced focus indicators
                                            </label>
                                            <div class="form-text">Improve keyboard navigation visibility</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="stats-card animate-fadeInUp animation-delay-100">
                                    <h6 class="fw-bold mb-3">Preview</h6>
                                    <div class="appearance-preview p-3 border rounded">
                                        <div
                                            class="preview-header d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="mb-0">Sample Content</h6>
                                            <i class="fas fa-cog text-muted"></i>
                                        </div>
                                        <p class="preview-text mb-3">
                                            This is how your content will look with the current settings.
                                            You can see the font family, size, and color scheme in action.
                                        </p>
                                        <div class="preview-buttons">
                                            <button class="btn btn-primary btn-sm me-2">Primary</button>
                                            <button class="btn btn-outline-secondary btn-sm">Secondary</button>
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <h6 class="fw-bold mb-3">Color Scheme</h6>
                                        <div class="color-palette d-flex gap-2 mb-3">
                                            <div class="color-swatch bg-primary rounded"></div>
                                            <div class="color-swatch bg-success rounded"></div>
                                            <div class="color-swatch bg-warning rounded"></div>
                                            <div class="color-swatch bg-danger rounded"></div>
                                            <div class="color-swatch bg-info rounded"></div>
                                        </div>
                                        <small class="text-muted">Current color palette</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="tab-pane fade" id="notifications" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="stats-card animate-fadeInUp">
                                    <h5 class="fw-bold mb-4">
                                        <i class="fas fa-bell me-2"></i>Notification Preferences
                                    </h5>

                                    <!-- Email Notifications -->
                                    <div class="notification-section mb-4">
                                        <h6 class="fw-semibold mb-3">Email Notifications</h6>
                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Study Reminders</div>
                                                <small class="text-muted">Daily reminders to maintain your study
                                                    streak</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="email-study-reminders" checked>
                                            </div>
                                        </div>

                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Progress Updates</div>
                                                <small class="text-muted">Weekly progress summaries and
                                                    achievements</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="email-progress-updates" checked>
                                            </div>
                                        </div>

                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">New Features</div>
                                                <small class="text-muted">Updates about new features and
                                                    improvements</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="email-new-features">
                                            </div>
                                        </div>

                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Security Alerts</div>
                                                <small class="text-muted">Important security notifications</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="email-security-alerts" checked disabled>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Push Notifications -->
                                    <div class="notification-section mb-4">
                                        <h6 class="fw-semibold mb-3">Push Notifications</h6>
                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Pomodoro Timer</div>
                                                <small class="text-muted">Alerts when timer sessions start/end</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="push-pomodoro"
                                                    checked>
                                            </div>
                                        </div>

                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Streak Reminders</div>
                                                <small class="text-muted">Reminders to maintain your study
                                                    streak</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="push-streak-reminders" checked>
                                            </div>
                                        </div>

                                        <div
                                            class="notification-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Achievements</div>
                                                <small class="text-muted">Notifications when you earn new badges</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="push-achievements"
                                                    checked>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Notification Schedule -->
                                    <div class="notification-section">
                                        <h6 class="fw-semibold mb-3">Notification Schedule</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Quiet Hours Start</label>
                                                    <input type="time" class="form-control-custom"
                                                        id="quiet-hours-start" value="22:00">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Quiet Hours End</label>
                                                    <input type="time" class="form-control-custom" id="quiet-hours-end"
                                                        value="08:00">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group-custom mt-3">
                                            <label class="form-label-custom">Study Reminder Time</label>
                                            <input type="time" class="form-control-custom" id="study-reminder-time"
                                                value="09:00">
                                            <div class="form-text">Daily reminder to start studying</div>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="weekend-notifications">
                                            <label class="form-check-label fw-semibold" for="weekend-notifications">
                                                Weekend notifications
                                            </label>
                                            <div class="form-text">Receive notifications on weekends</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="stats-card animate-fadeInUp animation-delay-100">
                                    <h6 class="fw-bold mb-3">Notification Test</h6>
                                    <p class="text-muted mb-3">Test your notification settings to make sure they work
                                        correctly.</p>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm"
                                            onclick="testEmailNotification()">
                                            <i class="fas fa-envelope me-1"></i>Test Email
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" onclick="testPushNotification()">
                                            <i class="fas fa-bell me-1"></i>Test Push
                                        </button>
                                    </div>

                                    <hr class="my-4">

                                    <h6 class="fw-bold mb-3">Notification Status</h6>
                                    <div class="status-item d-flex justify-content-between align-items-center mb-2">
                                        <span>Browser Permissions</span>
                                        <span class="badge bg-success" id="browser-permission-status">Granted</span>
                                    </div>
                                    <div class="status-item d-flex justify-content-between align-items-center mb-2">
                                        <span>Email Verification</span>
                                        <span class="badge bg-success" id="email-verification-status">Verified</span>
                                    </div>
                                    <div class="status-item d-flex justify-content-between align-items-center">
                                        <span>Last Notification</span>
                                        <span class="text-muted" id="last-notification-time">2 hours ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Study Settings -->
                    <div class="tab-pane fade" id="study" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="stats-card animate-fadeInUp">
                                    <h5 class="fw-bold mb-4">
                                        <i class="fas fa-book me-2"></i>Study Preferences
                                    </h5>

                                    <!-- Pomodoro Settings -->
                                    <div class="study-section mb-4">
                                        <h6 class="fw-semibold mb-3">Pomodoro Timer</h6>
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Focus Duration (minutes)</label>
                                                    <input type="number" class="form-control-custom" id="focus-duration"
                                                        value="25" min="5" max="60">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Short Break (minutes)</label>
                                                    <input type="number" class="form-control-custom"
                                                        id="short-break-duration" value="5" min="1" max="15">
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Long Break (minutes)</label>
                                                    <input type="number" class="form-control-custom"
                                                        id="long-break-duration" value="15" min="10" max="30">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row g-3 mt-2">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Sessions Until Long Break</label>
                                                    <input type="number" class="form-control-custom"
                                                        id="long-break-interval" value="4" min="2" max="8">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Notification Sound</label>
                                                    <select class="form-control-custom" id="notification-sound-select">
                                                        <option value="bell">Bell</option>
                                                        <option value="chime">Chime</option>
                                                        <option value="ding">Ding</option>
                                                        <option value="none">None</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="auto-start-breaks"
                                                checked>
                                            <label class="form-check-label fw-semibold" for="auto-start-breaks">
                                                Auto-start breaks
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Study Goals -->
                                    <div class="study-section mb-4">
                                        <h6 class="fw-semibold mb-3">Study Goals</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Daily Study Goal (minutes)</label>
                                                    <input type="number" class="form-control-custom"
                                                        id="daily-study-goal" value="60" min="15" max="480">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Weekly Study Goal (hours)</label>
                                                    <input type="number" class="form-control-custom"
                                                        id="weekly-study-goal" value="7" min="1" max="50">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="goal-notifications"
                                                checked>
                                            <label class="form-check-label fw-semibold" for="goal-notifications">
                                                Goal achievement notifications
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Learning Preferences -->
                                    <div class="study-section mb-4">
                                        <h6 class="fw-semibold mb-3">Learning Preferences</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Preferred Learning Style</label>
                                                    <select class="form-control-custom" id="learning-style-select">
                                                        <option value="visual">Visual</option>
                                                        <option value="auditory">Auditory</option>
                                                        <option value="kinesthetic">Kinesthetic</option>
                                                        <option value="reading">Reading/Writing</option>
                                                        <option value="mixed">Mixed</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group-custom">
                                                    <label class="form-label-custom">Difficulty Preference</label>
                                                    <select class="form-control-custom"
                                                        id="difficulty-preference-select">
                                                        <option value="beginner">Beginner</option>
                                                        <option value="intermediate" selected>Intermediate</option>
                                                        <option value="advanced">Advanced</option>
                                                        <option value="adaptive">Adaptive</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="adaptive-learning"
                                                checked>
                                            <label class="form-check-label fw-semibold" for="adaptive-learning">
                                                Adaptive learning path
                                            </label>
                                            <div class="form-text">Adjust content difficulty based on your progress
                                            </div>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="spaced-repetition"
                                                checked>
                                            <label class="form-check-label fw-semibold" for="spaced-repetition">
                                                Spaced repetition reminders
                                            </label>
                                            <div class="form-text">Get reminders to review topics at optimal intervals
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Auto-save and Backup -->
                                    <div class="study-section">
                                        <h6 class="fw-semibold mb-3">Data Management</h6>
                                        <div class="form-group-custom">
                                            <label class="form-label-custom">Auto-save Interval</label>
                                            <select class="form-control-custom" id="auto-save-interval-select">
                                                <option value="30">Every 30 seconds</option>
                                                <option value="60" selected>Every minute</option>
                                                <option value="300">Every 5 minutes</option>
                                                <option value="600">Every 10 minutes</option>
                                                <option value="0">Disabled</option>
                                            </select>
                                        </div>

                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="cloud-sync" checked>
                                            <label class="form-check-label fw-semibold" for="cloud-sync">
                                                Cloud synchronization
                                            </label>
                                            <div class="form-text">Sync your data across devices</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="stats-card animate-fadeInUp animation-delay-100">
                                    <h6 class="fw-bold mb-3">Study Statistics</h6>
                                    <div class="study-stats">
                                        <div class="stat-item d-flex justify-content-between mb-2">
                                            <span>Average Session</span>
                                            <span class="fw-bold" id="avg-session-length">25 min</span>
                                        </div>
                                        <div class="stat-item d-flex justify-content-between mb-2">
                                            <span>Best Day</span>
                                            <span class="fw-bold" id="best-study-day">Monday</span>
                                        </div>
                                        <div class="stat-item d-flex justify-content-between mb-2">
                                            <span>Preferred Time</span>
                                            <span class="fw-bold" id="preferred-study-time">9:00 AM</span>
                                        </div>
                                        <div class="stat-item d-flex justify-content-between">
                                            <span>Focus Score</span>
                                            <span class="fw-bold text-success" id="focus-score">85%</span>
                                        </div>
                                    </div>

                                    <hr class="my-4">

                                    <h6 class="fw-bold mb-3">Quick Settings</h6>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm"
                                            onclick="resetPomodoroSettings()">
                                            <i class="fas fa-undo me-1"></i>Reset Pomodoro
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" onclick="exportStudyData()">
                                            <i class="fas fa-download me-1"></i>Export Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="tab-pane fade" id="privacy" role="tabpanel">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="stats-card animate-fadeInUp">
                                    <h5 class="fw-bold mb-4">
                                        <i class="fas fa-shield-alt me-2"></i>Privacy & Security
                                    </h5>

                                    <!-- Data Privacy -->
                                    <div class="privacy-section mb-4">
                                        <h6 class="fw-semibold mb-3">Data Privacy</h6>
                                        <div
                                            class="privacy-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Profile Visibility</div>
                                                <small class="text-muted">Control who can see your profile
                                                    information</small>
                                            </div>
                                            <select class="form-select form-select-sm" style="width: auto;"
                                                id="profile-visibility-select">
                                                <option value="private" selected>Private</option>
                                                <option value="friends">Friends</option>
                                                <option value="public">Public</option>
                                            </select>
                                        </div>

                                        <div
                                            class="privacy-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Study Progress Sharing</div>
                                                <small class="text-muted">Allow others to see your study
                                                    progress</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="progress-sharing-switch">
                                            </div>
                                        </div>

                                        <div
                                            class="privacy-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Usage Analytics</div>
                                                <small class="text-muted">Share anonymous usage data to improve the
                                                    platform</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="usage-analytics-switch" checked>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Data Control -->
                                    <div class="privacy-section mb-4">
                                        <h6 class="fw-semibold mb-3">Data Control</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="data-control-card p-3 border rounded text-center">
                                                    <i class="fas fa-download text-primary fs-2 mb-2"></i>
                                                    <h6 class="fw-semibold">Download Your Data</h6>
                                                    <p class="text-muted small mb-3">Get a copy of all your data</p>
                                                    <button class="btn btn-outline-primary btn-sm"
                                                        onclick="downloadAllData()">
                                                        Download
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="data-control-card p-3 border rounded text-center">
                                                    <i class="fas fa-trash text-danger fs-2 mb-2"></i>
                                                    <h6 class="fw-semibold">Delete Account</h6>
                                                    <p class="text-muted small mb-3">Permanently delete your account</p>
                                                    <button class="btn btn-outline-danger btn-sm"
                                                        onclick="showDeleteAccountModal()">
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Security Settings -->
                                    <div class="privacy-section">
                                        <h6 class="fw-semibold mb-3">Security</h6>
                                        <div
                                            class="security-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Two-Factor Authentication</div>
                                                <small class="text-muted">Add an extra layer of security</small>
                                            </div>
                                            <button class="btn btn-outline-primary btn-sm" onclick="setup2FA()">
                                                Setup
                                            </button>
                                        </div>

                                        <div
                                            class="security-item d-flex justify-content-between align-items-center p-3 border rounded mb-2">
                                            <div>
                                                <div class="fw-semibold">Login Notifications</div>
                                                <small class="text-muted">Get notified of new login attempts</small>
                                            </div>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox"
                                                    id="login-notifications-switch" checked>
                                            </div>
                                        </div>

                                        <div
                                            class="security-item d-flex justify-content-between align-items-center p-3 border rounded">
                                            <div>
                                                <div class="fw-semibold">Session Management</div>
                                                <small class="text-muted">Manage active sessions across devices</small>
                                            </div>
                                            <button class="btn btn-outline-secondary btn-sm"
                                                onclick="manageActiveSessions()">
                                                Manage
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="stats-card animate-fadeInUp animation-delay-100">
                                    <h6 class="fw-bold mb-3">Privacy Score</h6>
                                    <div class="text-center mb-4">
                                        <div class="circular-progress">
                                            <svg width="100" height="100">
                                                <circle class="bg-circle" cx="50" cy="50" r="40" stroke="#e5e7eb"
                                                    stroke-width="6" fill="none"></circle>
                                                <circle class="progress-circle" cx="50" cy="50" r="40" stroke="#10b981"
                                                    stroke-width="6" fill="none" stroke-linecap="round"
                                                    style="stroke-dasharray: 201 251;"></circle>
                                            </svg>
                                            <div class="progress-label">
                                                <span class="fs-4 fw-bold text-success">80%</span>
                                            </div>
                                        </div>
                                        <p class="text-muted mt-2">Good privacy protection</p>
                                    </div>

                                    <div class="privacy-recommendations">
                                        <h6 class="fw-bold mb-3">Recommendations</h6>
                                        <div class="recommendation-item d-flex align-items-start mb-2">
                                            <i class="fas fa-shield-alt text-success me-2 mt-1"></i>
                                            <small>Enable two-factor authentication for better security</small>
                                        </div>
                                        <div class="recommendation-item d-flex align-items-start mb-2">
                                            <i class="fas fa-eye-slash text-warning me-2 mt-1"></i>
                                            <small>Consider making your profile private</small>
                                        </div>
                                        <div class="recommendation-item d-flex align-items-start">
                                            <i class="fas fa-download text-info me-2 mt-1"></i>
                                            <small>Regularly backup your data</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-2">
                            <button class="btn btn-outline-secondary" onclick="discardChanges()">
                                <i class="fas fa-times me-1"></i>Discard Changes
                            </button>
                            <button class="btn btn-primary" onclick="saveAllSettings()">
                                <i class="fas fa-save me-1"></i>Save All Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Include Mobile Navigation -->
        <div id="mobile-nav-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://dsa-backend-gj8n.onrender.com';
        let settingsData = {};
        let hasUnsavedChanges = false;

        document.addEventListener('DOMContentLoaded', function () {
            checkAuth();
            loadComponents();
            initializeSettings();
        });

        function checkAuth() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
        }

        async function loadComponents() {
            try {
                // Load sidebar
                const sidebarResponse = await fetch('../components/sidebar.html');
                const sidebarHtml = await sidebarResponse.text();
                document.getElementById('sidebar-container').innerHTML = sidebarHtml;

                // Load topbar
                const topbarResponse = await fetch('../components/topbar.html');
                const topbarHtml = await topbarResponse.text();
                document.getElementById('topbar-container').innerHTML = topbarHtml;

                // Load mobile nav
                const mobileNavResponse = await fetch('../components/mobile-nav.html');
                const mobileNavHtml = await mobileNavResponse.text();
                document.getElementById('mobile-nav-container').innerHTML = mobileNavHtml;

                // Execute scripts in loaded components
                setActiveNavItem();
                setActiveMobileNavItem();
                updatePageTitle();
                loadUserData();
            } catch (error) {
                console.error('Error loading components:', error);
            }
        }

        async function initializeSettings() {
            try {
                await loadUserPreferences();
                setupEventListeners();
                updateStorageInfo();
                checkNotificationPermissions();
                loadStudyStatistics();
            } catch (error) {
                console.error('Settings initialization error:', error);
                showErrorMessage('Failed to load settings');
            }
        }

        async function loadUserPreferences() {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE}/preferences`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    settingsData = data;
                    populateSettings();
                } else if (response.status === 401) {
                    localStorage.clear();
                    window.location.href = '/login';
                } else {
                    // Load default settings
                    loadDefaultSettings();
                }
            } catch (error) {
                console.error('Error loading preferences:', error);
                loadDefaultSettings();
            }
        }

        function loadDefaultSettings() {
            settingsData = {
                language: 'en',
                timezone: 'UTC',
                weekStart: 'sunday',
                dateFormat: 'MM/DD/YYYY',
                theme: 'light',
                sidebarWidth: 'default',
                contentWidth: 'container',
                fontFamily: 'inter',
                fontSize: 'default',
                autoSave: true,
                offlineMode: false,
                analytics: true,
                highContrast: false,
                reduceMotion: false,
                focusIndicators: true,
                emailNotifications: true,
                pushNotifications: true,
                quietHoursStart: '22:00',
                quietHoursEnd: '08:00',
                studyReminderTime: '09:00',
                weekendNotifications: false,
                focusDuration: 25,
                shortBreakDuration: 5,
                longBreakDuration: 15,
                longBreakInterval: 4,
                autoStartBreaks: true,
                notificationSound: 'bell',
                dailyStudyGoal: 60,
                weeklyStudyGoal: 7,
                goalNotifications: true,
                learningStyle: 'mixed',
                difficultyPreference: 'intermediate',
                adaptiveLearning: true,
                spacedRepetition: true,
                autoSaveInterval: 60,
                cloudSync: true,
                profileVisibility: 'private',
                progressSharing: false,
                usageAnalytics: true,
                loginNotifications: true
            };
            populateSettings();
        }

        function populateSettings() {
            // General settings
            document.getElementById('language-select').value = settingsData.language || 'en';
            document.getElementById('timezone-select').value = settingsData.timezone || 'UTC';
            document.getElementById('week-start-select').value = settingsData.weekStart || 'sunday';
            document.getElementById('date-format-select').value = settingsData.dateFormat || 'MM/DD/YYYY';
            document.getElementById('auto-save-switch').checked = settingsData.autoSave !== false;
            document.getElementById('offline-mode-switch').checked = settingsData.offlineMode === true;
            document.getElementById('analytics-switch').checked = settingsData.analytics !== false;

            // Appearance settings
            document.querySelector(`input[name="theme"][value="${settingsData.theme || 'light'}"]`).checked = true;
            document.getElementById('sidebar-width-select').value = settingsData.sidebarWidth || 'default';
            document.getElementById('content-width-select').value = settingsData.contentWidth || 'container';
            document.getElementById('font-family-select').value = settingsData.fontFamily || 'inter';
            document.getElementById('font-size-select').value = settingsData.fontSize || 'default';
            document.getElementById('high-contrast-switch').checked = settingsData.highContrast === true;
            document.getElementById('reduce-motion-switch').checked = settingsData.reduceMotion === true;
            document.getElementById('focus-indicators-switch').checked = settingsData.focusIndicators !== false;

            // Notification settings
            document.getElementById('email-study-reminders').checked = settingsData.emailNotifications !== false;
            document.getElementById('email-progress-updates').checked = settingsData.emailNotifications !== false;
            document.getElementById('email-new-features').checked = settingsData.emailNotifications === true;
            document.getElementById('email-security-alerts').checked = true; // Always enabled
            document.getElementById('push-pomodoro').checked = settingsData.pushNotifications !== false;
            document.getElementById('push-streak-reminders').checked = settingsData.pushNotifications !== false;
            document.getElementById('push-achievements').checked = settingsData.pushNotifications !== false;
            document.getElementById('quiet-hours-start').value = settingsData.quietHoursStart || '22:00';
            document.getElementById('quiet-hours-end').value = settingsData.quietHoursEnd || '08:00';
            document.getElementById('study-reminder-time').value = settingsData.studyReminderTime || '09:00';
            document.getElementById('weekend-notifications').checked = settingsData.weekendNotifications === true;

            // Study settings
            document.getElementById('focus-duration').value = settingsData.focusDuration || 25;
            document.getElementById('short-break-duration').value = settingsData.shortBreakDuration || 5;
            document.getElementById('long-break-duration').value = settingsData.longBreakDuration || 15;
            document.getElementById('long-break-interval').value = settingsData.longBreakInterval || 4;
            document.getElementById('auto-start-breaks').checked = settingsData.autoStartBreaks !== false;
            document.getElementById('notification-sound-select').value = settingsData.notificationSound || 'bell';
            document.getElementById('daily-study-goal').value = settingsData.dailyStudyGoal || 60;
            document.getElementById('weekly-study-goal').value = settingsData.weeklyStudyGoal || 7;
            document.getElementById('goal-notifications').checked = settingsData.goalNotifications !== false;
            document.getElementById('learning-style-select').value = settingsData.learningStyle || 'mixed';
            document.getElementById('difficulty-preference-select').value = settingsData.difficultyPreference || 'intermediate';
            document.getElementById('adaptive-learning').checked = settingsData.adaptiveLearning !== false;
            document.getElementById('spaced-repetition').checked = settingsData.spacedRepetition !== false;
            document.getElementById('auto-save-interval-select').value = settingsData.autoSaveInterval || 60;
            document.getElementById('cloud-sync').checked = settingsData.cloudSync !== false;

            // Privacy settings
            document.getElementById('profile-visibility-select').value = settingsData.profileVisibility || 'private';
            document.getElementById('progress-sharing-switch').checked = settingsData.progressSharing === true;
            document.getElementById('usage-analytics-switch').checked = settingsData.usageAnalytics !== false;
            document.getElementById('login-notifications-switch').checked = settingsData.loginNotifications !== false;
        }

        function setupEventListeners() {
            // Track changes for unsaved changes warning
            const formInputs = document.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                input.addEventListener('change', () => {
                    hasUnsavedChanges = true;
                    updatePreview();
                });
            });

            // Theme change preview
            document.querySelectorAll('input[name="theme"]').forEach(radio => {
                radio.addEventListener('change', updateThemePreview);
            });

            // Font preview
            document.getElementById('font-family-select').addEventListener('change', updateFontPreview);
            document.getElementById('font-size-select').addEventListener('change', updateFontPreview);

            // Warn before leaving with unsaved changes
            window.addEventListener('beforeunload', (e) => {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        }

        function updatePreview() {
            updateThemePreview();
            updateFontPreview();
        }

        function updateThemePreview() {
            const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
            const preview = document.querySelector('.appearance-preview');

            preview.className = 'appearance-preview p-3 border rounded';
            if (selectedTheme === 'dark') {
                preview.classList.add('bg-dark', 'text-white');
            } else if (selectedTheme === 'auto') {
                // Check system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    preview.classList.add('bg-dark', 'text-white');
                }
            }
        }

        function updateFontPreview() {
            const fontFamily = document.getElementById('font-family-select').value;
            const fontSize = document.getElementById('font-size-select').value;
            const preview = document.querySelector('.preview-text');

            // Apply font family
            const fontMap = {
                'inter': "'Inter', sans-serif",
                'roboto': "'Roboto', sans-serif",
                'open-sans': "'Open Sans', sans-serif",
                'lato': "'Lato', sans-serif",
                'source-sans': "'Source Sans Pro', sans-serif",
                'system': "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
            };

            preview.style.fontFamily = fontMap[fontFamily] || fontMap['inter'];

            // Apply font size
            const sizeMap = {
                'small': '14px',
                'default': '16px',
                'large': '18px',
                'extra-large': '20px'
            };

            preview.style.fontSize = sizeMap[fontSize] || sizeMap['default'];
        }

        function updateStorageInfo() {
            // Simulate storage calculation
            const notesStorage = Math.floor(Math.random() * 500) + 100; // KB
            const progressStorage = Math.floor(Math.random() * 100) + 50; // KB
            const cacheStorage = Math.floor(Math.random() * 1000) + 200; // KB
            const totalStorage = notesStorage + progressStorage + cacheStorage;

            document.getElementById('notes-storage').textContent = `${notesStorage} KB`;
            document.getElementById('progress-storage').textContent = `${progressStorage} KB`;
            document.getElementById('cache-storage').textContent = `${cacheStorage} KB`;
            document.getElementById('total-storage').textContent = `${totalStorage} KB`;
        }

        function checkNotificationPermissions() {
            if ('Notification' in window) {
                const permission = Notification.permission;
                const statusElement = document.getElementById('browser-permission-status');

                if (permission === 'granted') {
                    statusElement.textContent = 'Granted';
                    statusElement.className = 'badge bg-success';
                } else if (permission === 'denied') {
                    statusElement.textContent = 'Denied';
                    statusElement.className = 'badge bg-danger';
                } else {
                    statusElement.textContent = 'Pending';
                    statusElement.className = 'badge bg-warning';
                }
            }
        }

        function loadStudyStatistics() {
            // Simulate loading study statistics
            document.getElementById('avg-session-length').textContent = '28 min';
            document.getElementById('best-study-day').textContent = 'Wednesday';
            document.getElementById('preferred-study-time').textContent = '10:30 AM';
            document.getElementById('focus-score').textContent = '87%';
        }

        async function saveAllSettings() {
            try {
                const newSettings = gatherAllSettings();

                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE}/preferences`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newSettings)
                });

                if (response.ok) {
                    settingsData = newSettings;
                    hasUnsavedChanges = false;
                    showSuccessToast('Settings saved successfully!');
                    applySettingsToUI();
                } else {
                    showErrorToast('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showErrorToast('Network error. Please try again.');
            }
        }

        function gatherAllSettings() {
            return {
                // General
                language: document.getElementById('language-select').value,
                timezone: document.getElementById('timezone-select').value,
                weekStart: document.getElementById('week-start-select').value,
                dateFormat: document.getElementById('date-format-select').value,
                autoSave: document.getElementById('auto-save-switch').checked,
                offlineMode: document.getElementById('offline-mode-switch').checked,
                analytics: document.getElementById('analytics-switch').checked,

                // Appearance
                theme: document.querySelector('input[name="theme"]:checked').value,
                sidebarWidth: document.getElementById('sidebar-width-select').value,
                contentWidth: document.getElementById('content-width-select').value,
                fontFamily: document.getElementById('font-family-select').value,
                fontSize: document.getElementById('font-size-select').value,
                highContrast: document.getElementById('high-contrast-switch').checked,
                reduceMotion: document.getElementById('reduce-motion-switch').checked,
                focusIndicators: document.getElementById('focus-indicators-switch').checked,

                // Notifications
                emailNotifications: document.getElementById('email-study-reminders').checked,
                pushNotifications: document.getElementById('push-pomodoro').checked,
                quietHoursStart: document.getElementById('quiet-hours-start').value,
                quietHoursEnd: document.getElementById('quiet-hours-end').value,
                studyReminderTime: document.getElementById('study-reminder-time').value,
                weekendNotifications: document.getElementById('weekend-notifications').checked,

                // Study
                focusDuration: parseInt(document.getElementById('focus-duration').value),
                shortBreakDuration: parseInt(document.getElementById('short-break-duration').value),
                longBreakDuration: parseInt(document.getElementById('long-break-duration').value),
                longBreakInterval: parseInt(document.getElementById('long-break-interval').value),
                autoStartBreaks: document.getElementById('auto-start-breaks').checked,
                notificationSound: document.getElementById('notification-sound-select').value,
                dailyStudyGoal: parseInt(document.getElementById('daily-study-goal').value),
                weeklyStudyGoal: parseInt(document.getElementById('weekly-study-goal').value),
                goalNotifications: document.getElementById('goal-notifications').checked,
                learningStyle: document.getElementById('learning-style-select').value,
                difficultyPreference: document.getElementById('difficulty-preference-select').value,
                adaptiveLearning: document.getElementById('adaptive-learning').checked,
                spacedRepetition: document.getElementById('spaced-repetition').checked,
                autoSaveInterval: parseInt(document.getElementById('auto-save-interval-select').value),
                cloudSync: document.getElementById('cloud-sync').checked,

                // Privacy
                profileVisibility: document.getElementById('profile-visibility-select').value,
                progressSharing: document.getElementById('progress-sharing-switch').checked,
                usageAnalytics: document.getElementById('usage-analytics-switch').checked,
                loginNotifications: document.getElementById('login-notifications-switch').checked
            };
        }

        function applySettingsToUI() {
            // Apply theme immediately
            const theme = settingsData.theme;
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (theme === 'light') {
                document.body.classList.remove('dark-theme');
            } else if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.body.classList.toggle('dark-theme', prefersDark);
            }

            // Apply font settings
            const fontMap = {
                'inter': "'Inter', sans-serif",
                'roboto': "'Roboto', sans-serif",
                'open-sans': "'Open Sans', sans-serif",
                'lato': "'Lato', sans-serif",
                'source-sans': "'Source Sans Pro', sans-serif",
                'system': "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
            };

            const sizeMap = {
                'small': '14px',
                'default': '16px',
                'large': '18px',
                'extra-large': '20px'
            };

            document.documentElement.style.setProperty('--font-family', fontMap[settingsData.fontFamily]);
            document.documentElement.style.setProperty('--font-size', sizeMap[settingsData.fontSize]);
        }

        function discardChanges() {
            if (hasUnsavedChanges) {
                if (confirm('Are you sure you want to discard your changes?')) {
                    populateSettings();
                    hasUnsavedChanges = false;
                    showInfoToast('Changes discarded');
                }
            }
        }

        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to defaults? This cannot be undone.')) {
                loadDefaultSettings();
                hasUnsavedChanges = true;
                showInfoToast('Settings reset to defaults. Remember to save your changes.');
            }
        }

        function exportSettings() {
            const settings = gatherAllSettings();
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'dsa-path-settings.json';
            link.click();

            showSuccessToast('Settings exported successfully!');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';

            input.onchange = function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        try {
                            const importedSettings = JSON.parse(e.target.result);
                            settingsData = { ...settingsData, ...importedSettings };
                            populateSettings();
                            hasUnsavedChanges = true;
                            showSuccessToast('Settings imported successfully! Remember to save.');
                        } catch (error) {
                            showErrorToast('Invalid settings file');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            input.click();
        }

        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }

            // Clear localStorage items that are cache-related
            const cacheKeys = Object.keys(localStorage).filter(key =>
                key.startsWith('cache_') || key.startsWith('temp_')
            );
            cacheKeys.forEach(key => localStorage.removeItem(key));

            updateStorageInfo();
            showSuccessToast('Cache cleared successfully!');
        }

        async function downloadData() {
            try {
                const token = localStorage.getItem('access_token');

                // Fetch all user data
                const [profileRes, progressRes, notesRes, pomodoroRes] = await Promise.all([
                    fetch(`${API_BASE}/profile`, { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch(`${API_BASE}/progress`, { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch(`${API_BASE}/notes?per_page=1000`, { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch(`${API_BASE}/pomodoro/history?per_page=1000`, { headers: { 'Authorization': `Bearer ${token}` } })
                ]);

                const userData = {
                    profile: profileRes.ok ? await profileRes.json() : {},
                    progress: progressRes.ok ? await progressRes.json() : {},
                    notes: notesRes.ok ? await notesRes.json() : {},
                    pomodoro: pomodoroRes.ok ? await pomodoroRes.json() : {},
                    settings: settingsData,
                    exportDate: new Date().toISOString()
                };

                const dataStr = JSON.stringify(userData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `dsa-path-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();

                showSuccessToast('Data downloaded successfully!');
            } catch (error) {
                console.error('Error downloading data:', error);
                showErrorToast('Failed to download data');
            }
        }

        function testEmailNotification() {
            // Simulate email test
            showInfoToast('Test email sent! Check your inbox.');
        }

        function testPushNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('DSA Path Test', {
                    body: 'This is a test notification from DSA Path!',
                    icon: '/assets/icons/notification.png'
                });
            } else if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('DSA Path Test', {
                            body: 'This is a test notification from DSA Path!',
                            icon: '/assets/icons/notification.png'
                        });
                    }
                });
            } else {
                showErrorToast('Notifications are blocked. Please enable them in your browser settings.');
            }
        }

        function resetPomodoroSettings() {
            document.getElementById('focus-duration').value = 25;
            document.getElementById('short-break-duration').value = 5;
            document.getElementById('long-break-duration').value = 15;
            document.getElementById('long-break-interval').value = 4;
            document.getElementById('auto-start-breaks').checked = true;
            document.getElementById('notification-sound-select').value = 'bell';

            hasUnsavedChanges = true;
            showInfoToast('Pomodoro settings reset to defaults');
        }

        function exportStudyData() {
            const studySettings = {
                focusDuration: document.getElementById('focus-duration').value,
                shortBreakDuration: document.getElementById('short-break-duration').value,
                longBreakDuration: document.getElementById('long-break-duration').value,
                longBreakInterval: document.getElementById('long-break-interval').value,
                autoStartBreaks: document.getElementById('auto-start-breaks').checked,
                notificationSound: document.getElementById('notification-sound-select').value,
                dailyStudyGoal: document.getElementById('daily-study-goal').value,
                weeklyStudyGoal: document.getElementById('weekly-study-goal').value,
                goalNotifications: document.getElementById('goal-notifications').checked,
                learningStyle: document.getElementById('learning-style-select').value,
                difficultyPreference: document.getElementById('difficulty-preference-select').value,
                adaptiveLearning: document.getElementById('adaptive-learning').checked,
                spacedRepetition: document.getElementById('spaced-repetition').checked,
                autoSaveInterval: document.getElementById('auto-save-interval-select').value,
                cloudSync: document.getElementById('cloud-sync').checked
            };

            const dataStr = JSON.stringify(studySettings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'study-settings.json';
            link.click();

            showSuccessToast('Study settings exported!');
        }

        function downloadAllData() {
            downloadData();
        }

        function showDeleteAccountModal() {
            window.location.href = '/profile#delete-account';
        }

        function setup2FA() {
            showInfoToast('Two-factor authentication setup will be available soon!');
        }

        function manageActiveSessions() {
            window.location.href = '/profile#active-sessions';
        }

        // Toast functions
        function showSuccessToast(message) {
            showToast(message, 'success', 'fas fa-check-circle');
        }

        function showErrorToast(message) {
            showToast(message, 'danger', 'fas fa-exclamation-circle');
        }

        function showInfoToast(message) {
            showToast(message, 'info', 'fas fa-info-circle');
        }

        function showToast(message, type, icon) {
            const toast = document.createElement('div');
            toast.className = 'position-fixed top-0 end-0 p-3';
            toast.style.zIndex = '1060';
            toast.innerHTML = `
                <div class="toast show animate-slideInDown" role="alert">
                    <div class="toast-header bg-${type} text-white">
                        <i class="${icon} me-2"></i>
                        <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                        <button type="button" class="btn-close btn-close-white" onclick="this.closest('.toast').parentElement.remove()"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.remove();
                }
            }, 5000);
        }

        function showErrorMessage(message) {
            const container = document.querySelector('.content-area');
            const alert = document.createElement('div');
            alert.className = 'alert-custom alert-error-custom animate-fadeInDown';
            alert.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <span>${message}</span>
            `;

            container.insertBefore(alert, container.firstChild);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>

    <style>
        .settings-nav-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .settings-nav {
            flex-wrap: nowrap;
            border-bottom: 1px solid #e5e7eb;
            min-width: max-content;
        }

        .settings-nav .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            border-radius: 0;
            color: #6b7280;
            font-weight: 500;
            padding: 1rem 1.5rem;
            white-space: nowrap;
        }

        .settings-nav .nav-link:hover {
            background: none;
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .settings-nav .nav-link.active {
            background: none;
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .theme-option {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .theme-option:hover {
            transform: translateY(-2px);
        }

        .theme-preview {
            width: 100%;
            height: 100px;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            position: relative;
            overflow: hidden;
            transition: border-color 0.2s ease;
        }

        .theme-option input:checked+.theme-info .theme-preview,
        .theme-option:has(input:checked) .theme-preview {
            border-color: #3b82f6;
        }

        .light-theme {
            background: #ffffff;
        }

        .light-theme .theme-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: #f3f4f6;
        }

        .light-theme .theme-sidebar {
            position: absolute;
            top: 20px;
            left: 0;
            width: 30%;
            bottom: 0;
            background: #3b82f6;
        }

        .light-theme .theme-content {
            position: absolute;
            top: 20px;
            left: 30%;
            right: 0;
            bottom: 0;
            background: #ffffff;
        }

        .dark-theme {
            background: #1f2937;
        }

        .dark-theme .theme-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: #374151;
        }

        .dark-theme .theme-sidebar {
            position: absolute;
            top: 20px;
            left: 0;
            width: 30%;
            bottom: 0;
            background: #4b5563;
        }

        .dark-theme .theme-content {
            position: absolute;
            top: 20px;
            left: 30%;
            right: 0;
            bottom: 0;
            background: #1f2937;
        }

        .auto-theme {
            background: linear-gradient(90deg, #ffffff 50%, #1f2937 50%);
        }

        .auto-theme .theme-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(90deg, #f3f4f6 50%, #374151 50%);
        }

        .auto-theme .theme-sidebar {
            position: absolute;
            top: 20px;
            left: 0;
            width: 30%;
            bottom: 0;
            background: linear-gradient(180deg, #3b82f6 50%, #4b5563 50%);
        }

        .auto-theme .theme-content {
            position: absolute;
            top: 20px;
            left: 30%;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, #ffffff 50%, #1f2937 50%);
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border: 2px solid #e5e7eb;
        }

        .notification-item,
        .privacy-item,
        .security-item {
            transition: all 0.2s ease;
        }

        .notification-item:hover,
        .privacy-item:hover,
        .security-item:hover {
            background-color: #f8fafc;
        }

        .data-control-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .data-control-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .circular-progress {
            position: relative;
            display: inline-block;
        }

        .progress-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @media (max-width: 768px) {
            .settings-nav .nav-link {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            .theme-preview {
                height: 80px;
            }

            .color-swatch {
                width: 25px;
                height: 25px;
            }

            .data-control-card {
                margin-bottom: 1rem;
            }
        }
    </style>
</body>

</html>