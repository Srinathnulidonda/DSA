<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer - DSA Learning Platform</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .timer-container {
            max-width: 400px;
            margin: 0 auto;
        }

        .timer-circle {
            width: 300px;
            height: 300px;
            position: relative;
            margin: 0 auto;
        }

        .timer-circle svg {
            transform: rotate(-90deg);
        }

        .timer-circle-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 8;
        }

        .timer-circle-progress {
            fill: none;
            stroke: #667eea;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
        }

        .timer-circle-progress.break {
            stroke: #10b981;
        }

        .timer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .timer-display h1 {
            font-size: 4rem;
            font-weight: 300;
            margin: 0;
            color: #1f2937;
        }

        .timer-control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .timer-control-btn:hover {
            transform: scale(1.1);
        }

        .timer-settings {
            background: #f3f4f6;
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .session-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .session-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .session-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .pomodoro-log {
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .pomodoro-log.completed {
            border-left-color: #10b981;
        }

        .pomodoro-log.incomplete {
            border-left-color: #ef4444;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(1.3);
                opacity: 0;
            }
        }

        .pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 320px;
            border: 2px solid #667eea;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulse-ring 2s ease-out infinite;
        }

        .notification-sound {
            display: none;
        }

        @media (max-width: 768px) {
            .timer-circle {
                width: 250px;
                height: 250px;
            }

            .timer-display h1 {
                font-size: 3rem;
            }

            .pulse-ring {
                width: 270px;
                height: 270px;
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Desktop Sidebar -->
    <div id="sidebar" class="desktop-only"></div>

    <!-- Mobile Top Bar -->
    <div id="topbar" class="mobile-only"></div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid p-4">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="text-center">
                        <h1 class="h3 fw-bold mb-2">Pomodoro Timer</h1>
                        <p class="text-muted mb-0">Stay focused and boost productivity</p>
                    </div>
                </div>
            </div>

            <!-- Timer Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="timer-container">
                        <!-- Session Types -->
                        <div class="d-flex justify-content-center gap-2 mb-4">
                            <div class="session-card active px-4 py-2 rounded" data-session="focus">
                                <h6 class="mb-0">Focus</h6>
                                <small class="text-muted">25 min</small>
                            </div>
                            <div class="session-card px-4 py-2 rounded" data-session="short-break">
                                <h6 class="mb-0">Short Break</h6>
                                <small class="text-muted">5 min</small>
                            </div>
                            <div class="session-card px-4 py-2 rounded" data-session="long-break">
                                <h6 class="mb-0">Long Break</h6>
                                <small class="text-muted">15 min</small>
                            </div>
                        </div>

                        <!-- Timer Circle -->
                        <div class="timer-circle mb-4">
                            <div class="pulse-ring" id="pulseRing" style="display: none;"></div>
                            <svg width="100%" height="100%" viewBox="0 0 300 300">
                                <circle class="timer-circle-bg" cx="150" cy="150" r="145" />
                                <circle class="timer-circle-progress" id="timerProgress" cx="150" cy="150" r="145"
                                    stroke-dasharray="911.06" stroke-dashoffset="0" />
                            </svg>
                            <div class="timer-display">
                                <h1 id="timerDisplay">25:00</h1>
                                <p class="text-muted mb-0" id="sessionLabel">Focus Time</p>
                            </div>
                        </div>

                        <!-- Timer Controls -->
                        <div class="d-flex justify-content-center gap-3 mb-4">
                            <button class="btn btn-outline-secondary timer-control-btn" onclick="resetTimer()">
                                <i class="bi bi-arrow-clockwise fs-4"></i>
                            </button>
                            <button class="btn btn-primary timer-control-btn" id="startBtn" onclick="toggleTimer()">
                                <i class="bi bi-play-fill fs-3"></i>
                            </button>
                            <button class="btn btn-outline-secondary timer-control-btn" onclick="skipSession()">
                                <i class="bi bi-skip-forward-fill fs-4"></i>
                            </button>
                        </div>

                        <!-- Current Task -->
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="bi bi-pencil text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0 ps-0" id="currentTask"
                                        placeholder="What are you working on?">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings and Stats -->
            <div class="row">
                <!-- Settings -->
                <div class="col-lg-6 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0 fw-semibold">Timer Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="timer-settings">
                                <div class="row g-3">
                                    <div class="col-4">
                                        <label class="form-label small">Focus</label>
                                        <input type="number" class="form-control" id="focusDuration" value="25" min="1"
                                            max="60">
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label small">Short Break</label>
                                        <input type="number" class="form-control" id="shortBreakDuration" value="5"
                                            min="1" max="30">
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label small">Long Break</label>
                                        <input type="number" class="form-control" id="longBreakDuration" value="15"
                                            min="1" max="60">
                                    </div>
                                </div>

                                <hr class="my-3">

                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="autoStartBreaks" checked>
                                    <label class="form-check-label" for="autoStartBreaks">
                                        Auto-start breaks
                                    </label>
                                </div>

                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="autoStartPomodoros">
                                    <label class="form-check-label" for="autoStartPomodoros">
                                        Auto-start focus sessions
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="soundEnabled" checked>
                                    <label class="form-check-label" for="soundEnabled">
                                        Sound notifications
                                    </label>
                                </div>

                                <button class="btn btn-sm btn-primary mt-3" onclick="saveSettings()">
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Today's Stats -->
                <div class="col-lg-6 mb-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0 fw-semibold">Today's Stats</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-4">
                                <div class="col-6">
                                    <div class="text-center p-3 bg-light rounded">
                                        <i class="bi bi-check-circle fs-3 text-success mb-2 d-block"></i>
                                        <h3 class="fw-bold mb-0" id="completedSessions">0</h3>
                                        <small class="text-muted">Sessions</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-center p-3 bg-light rounded">
                                        <i class="bi bi-clock-history fs-3 text-primary mb-2 d-block"></i>
                                        <h3 class="fw-bold mb-0" id="totalFocusTime">0h</h3>
                                        <small class="text-muted">Focus Time</small>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">Goal Progress</h6>
                                <small class="text-muted">4h daily goal</small>
                            </div>
                            <div class="progress mb-3" style="height: 10px;">
                                <div id="goalProgress" class="progress-bar bg-primary" role="progressbar"
                                    style="width: 0%"></div>
                            </div>

                            <button class="btn btn-outline-primary btn-sm w-100" onclick="viewDetailedStats()">
                                View Detailed Stats
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Sessions -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0 fw-semibold">Recent Sessions</h5>
                                <a href="#" class="text-decoration-none small" onclick="viewAllSessions()">View all</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="recentSessions">
                                <!-- Recent sessions will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div id="mobileNav" class="mobile-only"></div>

    <!-- Audio elements -->
    <audio id="notificationSound" class="notification-sound">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
    </audio>

    <!-- Stats Modal -->
    <div class="modal fade" id="statsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pomodoro Statistics</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <canvas id="statsChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // API Configuration
        const API_BASE = 'https://dsa-8ko1.onrender.com/api';
        let authToken = null;

        // Timer state
        let timerInterval = null;
        let timeRemaining = 25 * 60; // 25 minutes in seconds
        let currentSession = 'focus';
        let isRunning = false;
        let sessionCount = 0;
        let todayStats = {
            sessions: 0,
            focusTime: 0
        };

        // Settings
        let settings = {
            focusDuration: 25,
            shortBreakDuration: 5,
            longBreakDuration: 15,
            autoStartBreaks: true,
            autoStartPomodoros: false,
            soundEnabled: true
        };

        // Initialize pomodoro page
        async function initPomodoro() {
            authToken = localStorage.getItem('access_token');

            if (!authToken) {
                window.location.href = '../auth/login.html';
                return;
            }

            // Load components
            await loadComponents();

            // Load settings from localStorage
            loadSettings();

            // Load today's stats
            await loadTodayStats();

            // Load recent sessions
            await loadRecentSessions();

            // Setup event listeners
            setupEventListeners();

            // Update display
            updateTimerDisplay();
        }

        // Load reusable components
        async function loadComponents() {
            // Load sidebar
            const sidebarResponse = await fetch('../components/sidebar.html');
            const sidebarHtml = await sidebarResponse.text();
            document.getElementById('sidebar').innerHTML = sidebarHtml;

            // Load topbar
            const topbarResponse = await fetch('../components/topbar.html');
            const topbarHtml = await topbarResponse.text();
            document.getElementById('topbar').innerHTML = topbarHtml;

            // Load mobile nav
            const mobileNavResponse = await fetch('../components/mobile-nav.html');
            const mobileNavHtml = await mobileNavResponse.text();
            document.getElementById('mobileNav').innerHTML = mobileNavHtml;

            // Set active states
            setActiveNavItem('pomodoro');
        }

        // Set active navigation item
        function setActiveNavItem(page) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === page) {
                    link.classList.add('active');
                }
            });

            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
        }

        // Load settings
        function loadSettings() {
            const saved = localStorage.getItem('pomodoroSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };

                // Update UI
                document.getElementById('focusDuration').value = settings.focusDuration;
                document.getElementById('shortBreakDuration').value = settings.shortBreakDuration;
                document.getElementById('longBreakDuration').value = settings.longBreakDuration;
                document.getElementById('autoStartBreaks').checked = settings.autoStartBreaks;
                document.getElementById('autoStartPomodoros').checked = settings.autoStartPomodoros;
                document.getElementById('soundEnabled').checked = settings.soundEnabled;
            }
        }

        // Save settings
        function saveSettings() {
            settings.focusDuration = parseInt(document.getElementById('focusDuration').value);
            settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            settings.autoStartBreaks = document.getElementById('autoStartBreaks').checked;
            settings.autoStartPomodoros = document.getElementById('autoStartPomodoros').checked;
            settings.soundEnabled = document.getElementById('soundEnabled').checked;

            localStorage.setItem('pomodoroSettings', JSON.stringify(settings));

            // Update timer if not running
            if (!isRunning) {
                setSession(currentSession);
            }

            showToast('Settings saved successfully', 'success');
        }

        // Set session type
        function setSession(type) {
            currentSession = type;

            // Update active session card
            document.querySelectorAll('.session-card').forEach(card => {
                if (card.dataset.session === type) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });

            // Update timer
            switch (type) {
                case 'focus':
                    timeRemaining = settings.focusDuration * 60;
                    document.getElementById('sessionLabel').textContent = 'Focus Time';
                    document.querySelector('.timer-circle-progress').classList.remove('break');
                    break;
                case 'short-break':
                    timeRemaining = settings.shortBreakDuration * 60;
                    document.getElementById('sessionLabel').textContent = 'Short Break';
                    document.querySelector('.timer-circle-progress').classList.add('break');
                    break;
                case 'long-break':
                    timeRemaining = settings.longBreakDuration * 60;
                    document.getElementById('sessionLabel').textContent = 'Long Break';
                    document.querySelector('.timer-circle-progress').classList.add('break');
                    break;
            }

            updateTimerDisplay();
            updateProgress();
        }

        // Toggle timer
        function toggleTimer() {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        // Start timer
        function startTimer() {
            isRunning = true;
            document.getElementById('startBtn').innerHTML = '<i class="bi bi-pause-fill fs-3"></i>';
            document.getElementById('pulseRing').style.display = 'block';

            // Record start time
            const sessionStart = new Date();

            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                updateProgress();

                if (timeRemaining <= 0) {
                    completeSession(sessionStart);
                }
            }, 1000);
        }

        // Pause timer
        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').innerHTML = '<i class="bi bi-play-fill fs-3"></i>';
            document.getElementById('pulseRing').style.display = 'none';
        }

        // Reset timer
        function resetTimer() {
            pauseTimer();
            setSession(currentSession);
        }

        // Skip session
        function skipSession() {
            pauseTimer();
            nextSession();
        }

        // Complete session
        async function completeSession(startTime) {
            pauseTimer();

            // Play notification sound
            if (settings.soundEnabled) {
                document.getElementById('notificationSound').play();
            }

            // Show notification
            showNotification('Session Complete!',
                currentSession === 'focus' ? 'Great work! Time for a break.' : 'Break over! Ready to focus?');

            // Log session if it was a focus session
            if (currentSession === 'focus') {
                const duration = Math.round((new Date() - startTime) / 60000); // minutes
                const task = document.getElementById('currentTask').value || 'Untitled session';

                await logPomodoro({
                    topic: task,
                    duration: duration,
                    completed: true,
                    started_at: startTime.toISOString(),
                    ended_at: new Date().toISOString()
                });

                // Update stats
                todayStats.sessions++;
                todayStats.focusTime += duration;
                updateStats();
            }

            // Auto-start next session
            nextSession();

            if ((currentSession === 'focus' && settings.autoStartPomodoros) ||
                (currentSession !== 'focus' && settings.autoStartBreaks)) {
                setTimeout(() => startTimer(), 1000);
            }
        }

        // Next session
        function nextSession() {
            if (currentSession === 'focus') {
                sessionCount++;
                // Every 4 pomodoros, take a long break
                if (sessionCount % 4 === 0) {
                    setSession('long-break');
                } else {
                    setSession('short-break');
                }
            } else {
                setSession('focus');
            }
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timerDisplay').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // Update page title
            if (isRunning) {
                document.title = `${minutes}:${seconds.toString().padStart(2, '0')} - ${currentSession === 'focus' ? 'Focus' : 'Break'}`;
            } else {
                document.title = 'Pomodoro Timer - DSA Learning Platform';
            }
        }

        // Update progress circle
        function updateProgress() {
            const totalTime = currentSession === 'focus' ?
                settings.focusDuration * 60 :
                (currentSession === 'short-break' ? settings.shortBreakDuration * 60 : settings.longBreakDuration * 60);

            const progress = (totalTime - timeRemaining) / totalTime;
            const circumference = 2 * Math.PI * 145; // radius = 145
            const offset = circumference * (1 - progress);

            document.getElementById('timerProgress').style.strokeDashoffset = offset;
        }

        // Log pomodoro session
        async function logPomodoro(data) {
            try {
                await fetch(`${API_BASE}/pomodoro`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                // Reload recent sessions
                await loadRecentSessions();

            } catch (error) {
                console.error('Error logging pomodoro:', error);
            }
        }

        // Load today's stats
        async function loadTodayStats() {
            try {
                const response = await fetch(`${API_BASE}/pomodoro`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Filter today's sessions
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    todayStats.sessions = 0;
                    todayStats.focusTime = 0;

                    data.logs.forEach(log => {
                        const logDate = new Date(log.started_at);
                        if (logDate >= today && log.completed) {
                            todayStats.sessions++;
                            todayStats.focusTime += log.duration;
                        }
                    });

                    updateStats();
                }

            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Update stats display
        function updateStats() {
            document.getElementById('completedSessions').textContent = todayStats.sessions;

            const hours = Math.floor(todayStats.focusTime / 60);
            const minutes = todayStats.focusTime % 60;
            document.getElementById('totalFocusTime').textContent =
                hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;

            // Update goal progress (4 hours = 240 minutes)
            const goalProgress = Math.min((todayStats.focusTime / 240) * 100, 100);
            document.getElementById('goalProgress').style.width = `${goalProgress}%`;
        }

        // Load recent sessions
        async function loadRecentSessions() {
            try {
                const response = await fetch(`${API_BASE}/pomodoro?limit=5`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const container = document.getElementById('recentSessions');

                    if (data.logs.length === 0) {
                        container.innerHTML = '<p class="text-muted text-center">No sessions yet today</p>';
                        return;
                    }

                    container.innerHTML = data.logs.map(log => {
                        const startTime = new Date(log.started_at);
                        const timeStr = startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        return `
                            <div class="pomodoro-log ${log.completed ? 'completed' : 'incomplete'} p-3 mb-2 rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">${log.topic || 'Untitled session'}</h6>
                                        <small class="text-muted">
                                            ${timeStr} â€¢ ${log.duration} minutes
                                            ${log.completed ? '' : ' (incomplete)'}
                                        </small>
                                    </div>
                                    <div>
                                        ${log.completed ?
                                '<i class="bi bi-check-circle text-success"></i>' :
                                '<i class="bi bi-x-circle text-danger"></i>'}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }

            } catch (error) {
                console.error('Error loading recent sessions:', error);
            }
        }

        // View detailed stats
        function viewDetailedStats() {
            // This would show a modal with charts and detailed statistics
            const modal = new bootstrap.Modal(document.getElementById('statsModal'));
            modal.show();

            // Load and display chart
            // Implementation would fetch more detailed data and create charts
        }

        // View all sessions
        function viewAllSessions() {
            // This would navigate to a dedicated sessions page or show a modal
            showToast('Full session history coming soon!', 'info');
        }

        // Show notification
        function showNotification(title, body) {
            // Check if browser supports notifications
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '/assets/icons/tomato.png'
                });
            }

            // Also show toast
            showToast(body, 'success');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Session cards
            document.querySelectorAll('.session-card').forEach(card => {
                card.addEventListener('click', function () {
                    if (!isRunning) {
                        setSession(this.dataset.session);
                    }
                });
            });

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Save task on change
            let taskTimeout;
            document.getElementById('currentTask').addEventListener('input', function () {
                clearTimeout(taskTimeout);
                taskTimeout = setTimeout(() => {
                    localStorage.setItem('currentPomodoroTask', this.value);
                }, 500);
            });

            // Load saved task
            const savedTask = localStorage.getItem('currentPomodoroTask');
            if (savedTask) {
                document.getElementById('currentTask').value = savedTask;
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastHtml = `
                <div class="toast align-items-center text-bg-${type} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;

            const toastContainer = document.querySelector('.toast-container') || createToastContainer();
            const toastElement = document.createElement('div');
            toastElement.innerHTML = toastHtml;
            toastContainer.appendChild(toastElement.firstElementChild);

            const toast = new bootstrap.Toast(toastElement.firstElementChild);
            toast.show();
        }

        // Create toast container
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(container);
            return container;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initPomodoro);
    </script>
</body>

</html>