<div class="page-container">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="bi bi-robot text-primary me-2"></i>
                        AI Learning Assistant
                    </h1>
                    <p class="text-muted mb-0">Get instant help with DSA concepts and problem-solving</p>
                </div>
                <div class="mt-3 mt-lg-0 d-flex gap-2">
                    <button class="btn btn-outline-secondary" onclick="clearChat()">
                        <i class="bi bi-trash me-2"></i>Clear Chat
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-magic me-2"></i>Quick Actions
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="generateStudyPlan()">
                                    <i class="bi bi-calendar-check me-2"></i>Generate Study Plan
                                </a></li>
                            <li><a class="dropdown-item" href="#" onclick="generateQuiz()">
                                    <i class="bi bi-question-circle me-2"></i>Create Practice Quiz
                                </a></li>
                            <li><a class="dropdown-item" href="#" onclick="explainConcept()">
                                    <i class="bi bi-lightbulb me-2"></i>Explain Concept
                                </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" onclick="showAIHelp()">
                                    <i class="bi bi-info-circle me-2"></i>How to Use
                                </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Chat Section -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-0 d-flex flex-column">
                    <!-- Chat Messages -->
                    <div class="chat-messages-container flex-grow-1 p-4" id="chat-container"
                        style="height: 600px; overflow-y: auto;">
                        <!-- Welcome Message -->
                        <div class="chat-message assistant mb-4">
                            <div class="d-flex">
                                <div class="chat-avatar bg-primary text-white">
                                    <i class="bi bi-robot"></i>
                                </div>
                                <div class="chat-bubble ms-3">
                                    <div class="fw-medium mb-1">AI Assistant</div>
                                    <p class="mb-0">👋 Hello! I'm your DSA learning assistant. I can help you with:</p>
                                    <ul class="mt-2 ps-3">
                                        <li>Explaining data structures and algorithms</li>
                                        <li>Solving coding problems step-by-step</li>
                                        <li>Creating personalized study plans</li>
                                        <li>Generating practice questions</li>
                                        <li>Reviewing your code and suggesting improvements</li>
                                    </ul>
                                    <p class="mb-0 mt-2">What would you like to learn about today?</p>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic messages will be added here -->
                        <div id="chat-messages"></div>

                        <!-- Loading indicator -->
                        <div id="typing-indicator" class="chat-message assistant mb-4 d-none">
                            <div class="d-flex">
                                <div class="chat-avatar bg-primary text-white">
                                    <i class="bi bi-robot"></i>
                                </div>
                                <div class="chat-bubble ms-3">
                                    <div class="typing-dots">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="chat-input-container border-top p-3">
                        <form id="chat-form" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <div class="input-group">
                                    <textarea class="form-control" id="chat-input" rows="1"
                                        placeholder="Ask me anything about DSA..."
                                        style="max-height: 100px; resize: none;" autocomplete="off"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="send-btn">
                                <i class="bi bi-send"></i>
                            </button>
                        </form>
                        <small class="text-muted mt-1 d-block">
                            <i class="bi bi-info-circle me-1"></i>
                            Press Enter to send, Shift+Enter for new line
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Suggested Topics -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom-0">
                    <h5 class="mb-0">
                        <i class="bi bi-lightbulb text-warning me-2"></i>
                        Suggested Topics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2" id="suggested-topics">
                        <button class="btn btn-outline-primary btn-sm text-start"
                            onclick="askQuestion('Explain binary search algorithm with examples')">
                            <i class="bi bi-search me-2"></i>
                            Binary Search Algorithm
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start"
                            onclick="askQuestion('What is the difference between stack and queue?')">
                            <i class="bi bi-stack me-2"></i>
                            Stack vs Queue
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start"
                            onclick="askQuestion('How do I detect a cycle in a linked list?')">
                            <i class="bi bi-link-45deg me-2"></i>
                            Cycle Detection in Linked List
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start"
                            onclick="askQuestion('Explain time complexity with examples')">
                            <i class="bi bi-clock me-2"></i>
                            Time Complexity Basics
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start"
                            onclick="askQuestion('What are dynamic programming patterns?')">
                            <i class="bi bi-grid me-2"></i>
                            Dynamic Programming Patterns
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Conversations -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom-0">
                    <h5 class="mb-0">
                        <i class="bi bi-clock-history text-info me-2"></i>
                        Recent Questions
                    </h5>
                </div>
                <div class="card-body">
                    <div id="recent-questions">
                        <!-- Will be populated from localStorage/API -->
                        <div class="text-center py-3 text-muted">
                            <small>Your recent questions will appear here</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning Resources -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0">
                    <h5 class="mb-0">
                        <i class="bi bi-book text-success me-2"></i>
                        Related Resources
                    </h5>
                </div>
                <div class="card-body">
                    <div id="related-resources">
                        <div class="text-center py-3 text-muted">
                            <small>Ask a question to see related resources</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Study Plan Modal -->
<div class="modal fade" id="studyPlanModal" tabindex="-1" aria-labelledby="studyPlanModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="studyPlanModalLabel">
                    <i class="bi bi-calendar-check me-2"></i>Generate Study Plan
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="study-plan-form">
                    <div class="mb-3">
                        <label for="available-time" class="form-label">Daily study time (minutes)</label>
                        <input type="number" class="form-control" id="available-time" value="60" min="30" max="240">
                    </div>
                    <div class="mb-3">
                        <label for="focus-areas" class="form-label">Focus areas</label>
                        <select class="form-select" id="focus-areas" multiple>
                            <option value="arrays">Arrays & Strings</option>
                            <option value="linkedlists">Linked Lists</option>
                            <option value="trees">Trees & Graphs</option>
                            <option value="dp">Dynamic Programming</option>
                            <option value="algorithms">Sorting & Searching</option>
                        </select>
                        <small class="text-muted">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                    <div class="mb-3">
                        <label for="difficulty-level" class="form-label">Difficulty preference</label>
                        <select class="form-select" id="difficulty-level">
                            <option value="beginner">Beginner</option>
                            <option value="medium" selected>Medium</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitStudyPlan()">
                    <i class="bi bi-magic me-1"></i>Generate Plan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quiz Modal -->
<div class="modal fade" id="quizModal" tabindex="-1" aria-labelledby="quizModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quizModalLabel">
                    <i class="bi bi-question-circle me-2"></i>Generate Practice Quiz
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="quiz-form">
                    <div class="mb-3">
                        <label for="quiz-topic" class="form-label">Topic</label>
                        <select class="form-select" id="quiz-topic">
                            <option value="arrays">Arrays</option>
                            <option value="linkedlists">Linked Lists</option>
                            <option value="stacks">Stacks & Queues</option>
                            <option value="trees">Trees</option>
                            <option value="graphs">Graphs</option>
                            <option value="sorting">Sorting Algorithms</option>
                            <option value="searching">Searching Algorithms</option>
                            <option value="dp">Dynamic Programming</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="quiz-difficulty" class="form-label">Difficulty</label>
                        <select class="form-select" id="quiz-difficulty">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="quiz-count" class="form-label">Number of questions</label>
                        <input type="number" class="form-control" id="quiz-count" value="5" min="3" max="10">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitQuizRequest()">
                    <i class="bi bi-check2-circle me-1"></i>Generate Quiz
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    let conversationHistory = [];
    let isProcessing = false;

    document.addEventListener('DOMContentLoaded', function () {
        setupChatInterface();
        loadRecentQuestions();
        loadSuggestedTopics();

        // Focus on input
        document.getElementById('chat-input').focus();
    });

    function setupChatInterface() {
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');

        // Form submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = chatInput.value.trim();
            if (question && !isProcessing) {
                await sendMessage(question);
            }
        });

        // Auto-resize textarea
        chatInput.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Handle Enter key
        chatInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });
    }

    async function sendMessage(question) {
        if (isProcessing) return;

        isProcessing = true;
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        const typingIndicator = document.getElementById('typing-indicator');

        // Disable input
        chatInput.disabled = true;
        sendBtn.disabled = true;

        // Add user message
        const userMessageHtml = createMessageElement('user', question);
        chatMessages.insertAdjacentHTML('beforeend', userMessageHtml);

        // Clear input
        chatInput.value = '';
        chatInput.style.height = 'auto';

        // Show typing indicator
        typingIndicator.classList.remove('d-none');
        scrollToBottom();

        try {
            // Send to AI API
            const response = await API.ai.ask(question);

            // Hide typing indicator
            typingIndicator.classList.add('d-none');

            // Add AI response
            const aiMessageHtml = createMessageElement('assistant', response.answer, response.citations);
            chatMessages.insertAdjacentHTML('beforeend', aiMessageHtml);

            // Save to conversation history
            conversationHistory.push({
                question,
                answer: response.answer,
                citations: response.citations,
                timestamp: new Date()
            });

            // Update recent questions
            saveRecentQuestion(question);
            loadRecentQuestions();

            // Update related resources if citations provided
            if (response.citations && response.citations.length > 0) {
                updateRelatedResources(response.citations);
            }

            // Apply syntax highlighting to code blocks
            Prism.highlightAll();

            // Handle service status
            if (response.service_status === 'quota_exceeded') {
                Notifications.warning('AI service is currently at capacity. Showing cached response.');
            }

        } catch (error) {
            console.error('AI Assistant error:', error);

            // Hide typing indicator
            typingIndicator.classList.add('d-none');

            // Show error message
            const errorMessage = error.message || 'Failed to get response. Please try again.';
            const errorHtml = createMessageElement('assistant', `I apologize, but I encountered an error: ${errorMessage}`, [], true);
            chatMessages.insertAdjacentHTML('beforeend', errorHtml);

            Notifications.handleApiError(error, 'AI Assistant');
        } finally {
            // Re-enable input
            chatInput.disabled = false;
            sendBtn.disabled = false;
            chatInput.focus();
            isProcessing = false;

            scrollToBottom();
        }
    }

    function createMessageElement(type, content, citations = [], isError = false) {
        const isUser = type === 'user';
        const timestamp = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

        let messageHtml = `
        <div class="chat-message ${type} mb-4">
            <div class="d-flex ${isUser ? 'flex-row-reverse' : ''}">
                <div class="chat-avatar ${isUser ? 'bg-secondary' : 'bg-primary'} text-white ${isUser ? 'ms-3' : 'me-3'}">
                    <i class="bi ${isUser ? 'bi-person' : 'bi-robot'}"></i>
                </div>
                <div class="chat-bubble ${isUser ? 'user-bubble' : ''} ${isError ? 'border-danger' : ''}">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                        <div class="fw-medium">${isUser ? 'You' : 'AI Assistant'}</div>
                        <small class="text-muted ms-2">${timestamp}</small>
                    </div>
                    <div class="message-content">${marked.parse(content)}</div>
    `;

        // Add citations if available
        if (citations && citations.length > 0) {
            messageHtml += `
            <div class="mt-3 pt-3 border-top">
                <small class="text-muted d-block mb-2">📚 Related Resources:</small>
                <div class="d-flex flex-wrap gap-2">
                    ${citations.map(citation => `
                        <a href="${citation.url}" target="_blank" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-link-45deg me-1"></i>
                            ${citation.title}
                        </a>
                    `).join('')}
                </div>
            </div>
        `;
        }

        messageHtml += `
                </div>
            </div>
        </div>
    `;

        return messageHtml;
    }

    function scrollToBottom() {
        const chatContainer = document.getElementById('chat-container');
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function askQuestion(question) {
        const chatInput = document.getElementById('chat-input');
        chatInput.value = question;
        chatInput.focus();

        // Auto-submit
        document.getElementById('chat-form').dispatchEvent(new Event('submit'));
    }

    function clearChat() {
        const confirmed = confirm('Are you sure you want to clear the chat history?');
        if (confirmed) {
            document.getElementById('chat-messages').innerHTML = '';
            conversationHistory = [];
            updateRelatedResources([]);
            Notifications.success('Chat cleared');
        }
    }

    function generateStudyPlan() {
        const modal = new bootstrap.Modal(document.getElementById('studyPlanModal'));
        modal.show();
    }

    async function submitStudyPlan() {
        try {
            const availableTime = document.getElementById('available-time').value;
            const focusAreas = Array.from(document.getElementById('focus-areas').selectedOptions)
                .map(option => option.value);
            const difficulty = document.getElementById('difficulty-level').value;

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('studyPlanModal'));
            modal.hide();

            // Show loading
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.classList.remove('d-none');
            scrollToBottom();

            // Generate study plan
            const response = await API.ai.generateStudyPlan({
                available_time: parseInt(availableTime),
                focus_areas: focusAreas,
                difficulty: difficulty
            });

            // Hide typing indicator
            typingIndicator.classList.add('d-none');

            // Add response to chat
            const chatMessages = document.getElementById('chat-messages');
            const planMessage = createMessageElement('assistant', response.study_plan);
            chatMessages.insertAdjacentHTML('beforeend', planMessage);

            scrollToBottom();

        } catch (error) {
            console.error('Study plan generation error:', error);
            Notifications.error('Failed to generate study plan');
        }
    }

    function generateQuiz() {
        const modal = new bootstrap.Modal(document.getElementById('quizModal'));
        modal.show();
    }

    async function submitQuizRequest() {
        try {
            const topic = document.getElementById('quiz-topic').value;
            const difficulty = document.getElementById('quiz-difficulty').value;
            const count = document.getElementById('quiz-count').value;

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('quizModal'));
            modal.hide();

            // Show loading
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.classList.remove('d-none');
            scrollToBottom();

            // Generate quiz
            const response = await API.ai.generateQuiz(topic, difficulty, parseInt(count));

            // Hide typing indicator
            typingIndicator.classList.add('d-none');

            // Add response to chat
            const chatMessages = document.getElementById('chat-messages');
            const quizMessage = createMessageElement('assistant', response.quiz);
            chatMessages.insertAdjacentHTML('beforeend', quizMessage);

            scrollToBottom();

        } catch (error) {
            console.error('Quiz generation error:', error);
            Notifications.error('Failed to generate quiz');
        }
    }

    function explainConcept() {
        const concepts = [
            'Big O notation',
            'Binary tree traversal',
            'Hash table implementation',
            'Graph algorithms',
            'Recursion basics'
        ];

        const concept = concepts[Math.floor(Math.random() * concepts.length)];
        askQuestion(`Can you explain ${concept} with examples?`);
    }

    function showAIHelp() {
        const helpMessage = `
        **How to Use the AI Assistant:**
        
        🤖 **Ask Questions:** Type any DSA-related question and I'll provide detailed explanations.
        
        📚 **Request Examples:** Ask for code examples in your preferred programming language.
        
        🧩 **Problem Solving:** Share a problem and I'll guide you through the solution step-by-step.
        
        📝 **Code Review:** Paste your code and ask for optimization suggestions.
        
        🎯 **Study Plans:** Use the Quick Actions menu to generate personalized study plans.
        
        **Example Questions:**
        - "How do I implement a binary search tree?"
        - "What's the time complexity of merge sort?"
        - "Show me how to detect a cycle in a graph"
        - "Explain dynamic programming with examples"
    `;

        const chatMessages = document.getElementById('chat-messages');
        const helpHtml = createMessageElement('assistant', helpMessage);
        chatMessages.insertAdjacentHTML('beforeend', helpHtml);
        scrollToBottom();
    }

    function saveRecentQuestion(question) {
        let recentQuestions = Storage.get('recent_ai_questions', []);

        // Add new question at the beginning
        recentQuestions.unshift({
            question,
            timestamp: new Date()
        });

        // Keep only last 10 questions
        recentQuestions = recentQuestions.slice(0, 10);

        Storage.set('recent_ai_questions', recentQuestions);
    }

    function loadRecentQuestions() {
        const recentQuestions = Storage.get('recent_ai_questions', []);
        const container = document.getElementById('recent-questions');

        if (recentQuestions.length === 0) {
            container.innerHTML = `
            <div class="text-center py-3 text-muted">
                <small>Your recent questions will appear here</small>
            </div>
        `;
            return;
        }

        container.innerHTML = recentQuestions.slice(0, 5).map(item => `
        <div class="d-flex align-items-start mb-2">
            <i class="bi bi-chat-dots text-muted me-2 mt-1"></i>
            <div class="flex-grow-1">
                <a href="#" class="text-decoration-none small" 
                   onclick="askQuestion('${item.question.replace(/'/g, "\\'")}'); return false;">
                    ${Utils.truncate(item.question, 50)}
                </a>
                <div class="text-muted" style="font-size: 0.75rem;">
                    ${Utils.getRelativeTime(item.timestamp)}
                </div>
            </div>
        </div>
    `).join('');
    }

    function loadSuggestedTopics() {
        // In a real app, these would be dynamically generated based on user progress
        const currentWeek = 1; // Would be fetched from user progress
        const topics = [
            { week: 1, topic: 'Arrays', question: 'Explain array operations and time complexities' },
            { week: 2, topic: 'Linked Lists', question: 'How do I reverse a linked list?' },
            { week: 3, topic: 'Stacks', question: 'What are real-world applications of stacks?' },
            { week: 4, topic: 'Trees', question: 'Explain tree traversal methods' },
            { week: 5, topic: 'Graphs', question: 'What is the difference between DFS and BFS?' }
        ];

        // Update suggested topics based on current progress
        const container = document.getElementById('suggested-topics');
        const relevantTopics = topics.filter(t => t.week <= currentWeek + 1).slice(0, 5);

        container.innerHTML = relevantTopics.map(topic => `
        <button class="btn btn-outline-primary btn-sm text-start" 
                onclick="askQuestion('${topic.question}')">
            <i class="bi bi-lightbulb me-2"></i>
            ${topic.topic}: ${topic.question}
        </button>
    `).join('');
    }

    function updateRelatedResources(citations) {
        const container = document.getElementById('related-resources');

        if (!citations || citations.length === 0) {
            container.innerHTML = `
            <div class="text-center py-3 text-muted">
                <small>Ask a question to see related resources</small>
            </div>
        `;
            return;
        }

        container.innerHTML = citations.map(resource => {
            const typeIcon = {
                'text': 'bi-file-text',
                'video': 'bi-play-circle',
                'interactive': 'bi-diagram-3',
                'practice': 'bi-code-slash'
            };

            const icon = typeIcon[resource.type] || 'bi-link-45deg';

            return `
            <div class="resource-item mb-3">
                <a href="${resource.url}" target="_blank" 
                   class="d-flex align-items-start text-decoration-none">
                    <i class="${icon} text-primary me-2 mt-1"></i>
                    <div>
                        <div class="fw-medium text-dark">${resource.title}</div>
                        <small class="text-muted">${Utils.titleCase(resource.type)}</small>
                    </div>
                </a>
            </div>
        `;
        }).join('');
    }

    // Add CSS for chat styling
    const chatStyle = document.createElement('style');
    chatStyle.textContent = `
    .chat-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .chat-bubble {
        background: var(--bs-light);
        border-radius: 12px;
        padding: 12px 16px;
        max-width: 70%;
        word-wrap: break-word;
    }
    
    .chat-bubble.user-bubble {
        background: var(--bs-primary);
        color: white;
    }
    
    .chat-bubble.user-bubble a {
        color: white;
        text-decoration: underline;
    }
    
    .chat-bubble pre {
        background: rgba(0, 0, 0, 0.05);
        padding: 8px;
        border-radius: 4px;
        overflow-x: auto;
    }
    
    .chat-bubble.user-bubble pre {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .typing-dots {
        display: flex;
        gap: 4px;
    }
    
    .typing-dots span {
        width: 8px;
        height: 8px;
        background: var(--bs-primary);
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }
    
    .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing {
        0%, 60%, 100% {
            opacity: 0.2;
            transform: scale(0.8);
        }
        30% {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .message-content p:last-child {
        margin-bottom: 0;
    }
    
    .resource-item:hover {
        background: var(--bs-light);
        margin-left: -8px;
        margin-right: -8px;
        padding: 0 8px;
        border-radius: 4px;
    }
`;
    document.head.appendChild(chatStyle);
</script>