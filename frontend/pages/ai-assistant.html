<div class="container-fluid p-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
                <div>
                    <h1 class="h3 fw-bold mb-1">
                        <i class="fas fa-robot text-info me-2"></i>
                        AI Learning Assistant
                    </h1>
                    <p class="text-muted mb-0">Get instant help with DSA concepts, problems, and study guidance</p>
                </div>
                <div class="d-flex gap-2 mt-3 mt-lg-0">
                    <button class="btn btn-outline-primary" id="study-plan-btn">
                        <i class="fas fa-calendar me-2"></i>Generate Study Plan
                    </button>
                    <button class="btn btn-outline-secondary" id="quiz-btn">
                        <i class="fas fa-question-circle me-2"></i>Create Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card chat-container h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-comments me-2"></i>Chat with AI Assistant
                    </h5>
                    <button class="btn btn-sm btn-outline-secondary" id="clear-chat-btn">
                        <i class="fas fa-trash me-1"></i>Clear Chat
                    </button>
                </div>

                <div class="card-body p-0 d-flex flex-column" style="height: 600px;">
                    <!-- Chat Messages -->
                    <div class="chat-messages flex-grow-1 p-3" id="chat-messages" style="overflow-y: auto;">
                        <!-- Welcome message -->
                        <div class="message assistant-message mb-3">
                            <div class="message-avatar">
                                <i class="fas fa-robot text-info"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-bubble bg-light p-3 rounded">
                                    <p class="mb-2">üëã Hello! I'm your AI learning assistant. I can help you with:</p>
                                    <ul class="mb-2">
                                        <li>Explaining DSA concepts and algorithms</li>
                                        <li>Solving coding problems step by step</li>
                                        <li>Creating personalized study plans</li>
                                        <li>Generating practice quizzes</li>
                                        <li>Reviewing your progress and giving tips</li>
                                    </ul>
                                    <p class="mb-0">What would you like to learn about today?</p>
                                </div>
                                <small class="text-muted">Just now</small>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="chat-input border-top p-3">
                        <form id="chat-form">
                            <div class="input-group">
                                <textarea class="form-control" id="message-input"
                                    placeholder="Ask me anything about DSA..." rows="1"
                                    style="resize: none; max-height: 120px;" data-auto-resize></textarea>
                                <button class="btn btn-primary" type="submit" id="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                        <div class="mt-2">
                            <small class="text-muted">Press Enter to send ‚Ä¢ Shift+Enter for new line</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Sidebar -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-lightning-bolt me-2 text-warning"></i>Quick Actions
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary text-start"
                            onclick="sendQuickMessage('Explain binary search algorithm')">
                            <i class="fas fa-search me-2"></i>Explain Binary Search
                        </button>
                        <button class="btn btn-outline-primary text-start"
                            onclick="sendQuickMessage('How do I solve two pointer problems?')">
                            <i class="fas fa-hand-pointer me-2"></i>Two Pointer Technique
                        </button>
                        <button class="btn btn-outline-primary text-start"
                            onclick="sendQuickMessage('What is time complexity?')">
                            <i class="fas fa-clock me-2"></i>Time Complexity
                        </button>
                        <button class="btn btn-outline-primary text-start"
                            onclick="sendQuickMessage('Help me with dynamic programming')">
                            <i class="fas fa-chart-line me-2"></i>Dynamic Programming
                        </button>
                        <button class="btn btn-outline-primary text-start"
                            onclick="sendQuickMessage('Explain graph traversal algorithms')">
                            <i class="fas fa-project-diagram me-2"></i>Graph Algorithms
                        </button>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-history me-2"></i>Recent Questions
                    </h6>
                </div>
                <div class="card-body">
                    <div id="recent-questions">
                        <p class="text-muted text-center">No recent questions</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>Pro Tips
                    </h6>
                </div>
                <div class="card-body">
                    <div class="tip-item mb-3">
                        <div class="small fw-bold mb-1">üí° Be Specific</div>
                        <div class="small text-muted">Ask detailed questions for better explanations</div>
                    </div>
                    <div class="tip-item mb-3">
                        <div class="small fw-bold mb-1">üîç Ask for Examples</div>
                        <div class="small text-muted">Request code examples and visualizations</div>
                    </div>
                    <div class="tip-item">
                        <div class="small fw-bold mb-1">üìö Follow Up</div>
                        <div class="small text-muted">Ask follow-up questions to deepen understanding</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Study Plan Modal -->
<div class="modal fade" id="studyPlanModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate Personalized Study Plan</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="study-plan-form">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="available-time" class="form-label">Daily Study Time (minutes)</label>
                            <select class="form-select" id="available-time">
                                <option value="30">30 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                                <option value="180">3+ hours</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="difficulty-level" class="form-label">Preferred Difficulty</label>
                            <select class="form-select" id="difficulty-level">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate" selected>Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Focus Areas (Select up to 3)</label>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="arrays"
                                        id="focus-arrays">
                                    <label class="form-check-label" for="focus-arrays">Arrays & Strings</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="linkedlists"
                                        id="focus-linkedlists">
                                    <label class="form-check-label" for="focus-linkedlists">Linked Lists</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="trees"
                                        id="focus-trees">
                                    <label class="form-check-label" for="focus-trees">Trees & BST</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="graphs"
                                        id="focus-graphs">
                                    <label class="form-check-label" for="focus-graphs">Graphs</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="dp" id="focus-dp">
                                    <label class="form-check-label" for="focus-dp">Dynamic Programming</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="sorting"
                                        id="focus-sorting">
                                    <label class="form-check-label" for="focus-sorting">Sorting & Searching</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="recursion"
                                        id="focus-recursion">
                                    <label class="form-check-label" for="focus-recursion">Recursion &
                                        Backtracking</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input focus-area" type="checkbox" value="heap"
                                        id="focus-heap">
                                    <label class="form-check-label" for="focus-heap">Heaps & Priority Queues</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generate-plan-btn">
                    <i class="fas fa-magic me-2"></i>Generate Plan
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quiz Modal -->
<div class="modal fade" id="quizModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate Practice Quiz</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="quiz-form">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="quiz-topic" class="form-label">Topic</label>
                            <select class="form-select" id="quiz-topic">
                                <option value="arrays">Arrays</option>
                                <option value="linkedlists">Linked Lists</option>
                                <option value="stacks">Stacks & Queues</option>
                                <option value="trees">Trees</option>
                                <option value="graphs">Graphs</option>
                                <option value="sorting">Sorting</option>
                                <option value="dp">Dynamic Programming</option>
                                <option value="general">General DSA</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="quiz-difficulty" class="form-label">Difficulty</label>
                            <select class="form-select" id="quiz-difficulty">
                                <option value="easy">Easy</option>
                                <option value="medium" selected>Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="quiz-count" class="form-label">Number of Questions</label>
                            <select class="form-select" id="quiz-count">
                                <option value="3">3 Questions</option>
                                <option value="5" selected>5 Questions</option>
                                <option value="10">10 Questions</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generate-quiz-btn">
                    <i class="fas fa-question-circle me-2"></i>Generate Quiz
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async function () {
        let conversationHistory = [];
        let isWaitingForResponse = false;

        setupEventListeners();
        loadRecentQuestions();

        function setupEventListeners() {
            // Chat form submission
            document.getElementById('chat-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                await sendMessage();
            });

            // Message input enhancements
            const messageInput = document.getElementById('message-input');
            messageInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.getElementById('chat-form').dispatchEvent(new Event('submit'));
                }
            });

            // Auto-resize textarea
            messageInput.addEventListener('input', autoResizeTextarea);

            // Clear chat
            document.getElementById('clear-chat-btn').addEventListener('click', clearChat);

            // Study plan modal
            document.getElementById('study-plan-btn').addEventListener('click', openStudyPlanModal);
            document.getElementById('generate-plan-btn').addEventListener('click', generateStudyPlan);

            // Quiz modal
            document.getElementById('quiz-btn').addEventListener('click', openQuizModal);
            document.getElementById('generate-quiz-btn').addEventListener('click', generateQuiz);

            // Focus area limit
            document.querySelectorAll('.focus-area').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const checked = document.querySelectorAll('.focus-area:checked');
                    if (checked.length > 3) {
                        this.checked = false;
                        Notifications.warning('Please select up to 3 focus areas');
                    }
                });
            });
        }

        async function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value.trim();

            if (!message || isWaitingForResponse) return;

            // Add user message to chat
            addMessageToChat(message, 'user');

            // Clear input
            messageInput.value = '';
            autoResizeTextarea.call(messageInput);

            // Show typing indicator
            showTypingIndicator();
            isWaitingForResponse = true;

            try {
                // Send to AI
                const response = await ApiMethods.ai.ask(message);

                // Remove typing indicator
                removeTypingIndicator();

                if (response.error) {
                    // Handle service unavailable gracefully
                    addMessageToChat(
                        response.fallback_answer || 'I apologize, but I\'m temporarily unavailable. Please try again later.',
                        'assistant',
                        response.citations
                    );
                } else {
                    // Add AI response to chat
                    addMessageToChat(response.answer, 'assistant', response.citations);
                }

                // Add to conversation history
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: response.answer || response.fallback_answer }
                );

                // Update recent questions
                updateRecentQuestions(message);

            } catch (error) {
                console.error('AI request failed:', error);
                removeTypingIndicator();

                let errorMessage = 'I\'m experiencing some technical difficulties. ';

                if (!navigator.onLine) {
                    errorMessage += 'Please check your internet connection and try again.';
                } else {
                    errorMessage += 'Please try rephrasing your question or try again in a moment.';
                }

                addMessageToChat(errorMessage, 'assistant');
            } finally {
                isWaitingForResponse = false;
            }
        }

        function addMessageToChat(content, sender, citations = null) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message mb-3`;

            if (sender === 'user') {
                messageDiv.innerHTML = `
                <div class="message-content text-end">
                    <div class="message-bubble bg-primary text-white p-3 rounded d-inline-block">
                        ${content.replace(/\n/g, '<br>')}
                    </div>
                    <div><small class="text-muted">${Utils.date.format(new Date(), 'HH:mm')}</small></div>
                </div>
                <div class="message-avatar ms-2">
                    <img src="${Storage.user.getUserData()?.avatar_url || '/assets/icons/default-avatar.svg'}" 
                         class="rounded-circle" width="32" height="32" alt="You">
                </div>
            `;
            } else {
                const formattedContent = typeof marked !== 'undefined' ? marked.parse(content) : content.replace(/\n/g, '<br>');

                messageDiv.innerHTML = `
                <div class="message-avatar me-2">
                    <i class="fas fa-robot text-info"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble bg-light p-3 rounded">
                        ${formattedContent}
                        ${citations && citations.length > 0 ? `
                            <div class="mt-3 pt-2 border-top">
                                <small class="text-muted d-block mb-2">üìö Related Resources:</small>
                                ${citations.map(cite => `
                                    <a href="${cite.url}" target="_blank" rel="noopener" 
                                       class="badge bg-info text-decoration-none me-1 mb-1">
                                        ${cite.title}
                                    </a>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-1">
                        <small class="text-muted">${Utils.date.format(new Date(), 'HH:mm')}</small>
                        <div>
                            <button class="btn btn-sm btn-ghost" onclick="copyMessage(this)" title="Copy message">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="btn btn-sm btn-ghost" onclick="askFollowUp(this)" title="Ask follow-up">
                                <i class="fas fa-reply"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Add entrance animation
            messageDiv.classList.add('animate-fade-in-up');
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message assistant-message mb-3';
            typingDiv.innerHTML = `
            <div class="message-avatar me-2">
                <i class="fas fa-robot text-info"></i>
            </div>
            <div class="message-content">
                <div class="message-bubble bg-light p-3 rounded">
                    <div class="typing-animation">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <small class="text-muted">AI is thinking...</small>
                </div>
            </div>
        `;

            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function autoResizeTextarea() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        }

        function clearChat() {
            const messagesContainer = document.getElementById('chat-messages');
            // Keep only the welcome message
            const welcomeMessage = messagesContainer.firstElementChild;
            messagesContainer.innerHTML = '';
            messagesContainer.appendChild(welcomeMessage);

            conversationHistory = [];
            Notifications.info('Chat cleared');
        }

        function openStudyPlanModal() {
            const modal = new bootstrap.Modal(document.getElementById('studyPlanModal'));
            modal.show();
        }

        async function generateStudyPlan() {
            const availableTime = document.getElementById('available-time').value;
            const difficulty = document.getElementById('difficulty-level').value;
            const focusAreas = Array.from(document.querySelectorAll('.focus-area:checked')).map(cb => cb.value);

            const generateBtn = document.getElementById('generate-plan-btn');
            const originalText = generateBtn.innerHTML;

            try {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';

                const response = await ApiMethods.ai.generateStudyPlan({
                    available_time: parseInt(availableTime),
                    difficulty: difficulty,
                    focus_areas: focusAreas
                });

                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('studyPlanModal')).hide();

                // Add study plan to chat
                addMessageToChat(response.study_plan, 'assistant');

                Notifications.success('Study plan generated successfully!');

            } catch (error) {
                console.error('Failed to generate study plan:', error);

                // Fallback study plan
                const fallbackPlan = `
## Personalized Study Plan

**Daily Time:** ${availableTime} minutes
**Difficulty:** ${difficulty}
**Focus Areas:** ${focusAreas.join(', ') || 'General DSA'}

### Week Schedule:
- **Monday-Wednesday:** Core concept learning (${Math.round(availableTime * 0.6)} min)
- **Thursday-Friday:** Problem practice (${Math.round(availableTime * 0.8)} min)
- **Weekend:** Review and projects (${availableTime} min each day)

### Daily Structure:
1. **Theory Review** (${Math.round(availableTime * 0.3)} min)
2. **Hands-on Practice** (${Math.round(availableTime * 0.5)} min)
3. **Reflection & Notes** (${Math.round(availableTime * 0.2)} min)

üìö **Resources:** Check the Resources tab for study materials
üìù **Tip:** Take notes and track your progress in the app!
            `;

                addMessageToChat(fallbackPlan, 'assistant');
                Notifications.warning('Generated a basic study plan. AI service is temporarily limited.');
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = originalText;
            }
        }

        function openQuizModal() {
            const modal = new bootstrap.Modal(document.getElementById('quizModal'));
            modal.show();
        }

        async function generateQuiz() {
            const topic = document.getElementById('quiz-topic').value;
            const difficulty = document.getElementById('quiz-difficulty').value;
            const questionCount = parseInt(document.getElementById('quiz-count').value);

            const generateBtn = document.getElementById('generate-quiz-btn');
            const originalText = generateBtn.innerHTML;

            try {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Quiz...';

                const response = await ApiMethods.ai.generateQuiz({
                    topic: topic,
                    difficulty: difficulty,
                    question_count: questionCount
                });

                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('quizModal')).hide();

                // Add quiz to chat
                addMessageToChat(response.quiz, 'assistant');

                Notifications.success('Quiz generated successfully!');

            } catch (error) {
                console.error('Failed to generate quiz:', error);

                // Fallback quiz
                const fallbackQuiz = `
## ${difficulty.toUpperCase()} Level Quiz on ${topic.toUpperCase()}

Due to high demand, here's a practice structure for ${topic}:

### Study Focus Areas:
1. **Time & Space Complexity** - Analyze algorithmic efficiency
2. **Implementation** - Code the core algorithms
3. **Problem Solving** - Apply concepts to real problems
4. **Optimization** - Improve your solutions

### Recommended Practice:
- LeetCode problems tagged with "${topic}"
- Visualizations from the Resources tab
- Code implementation in your preferred language

### Next Steps:
1. Review the theory first
2. Practice with simple examples  
3. Solve progressively harder problems
4. Time yourself and optimize

üìö Check the Resources section for topic-specific materials!
            `;

                addMessageToChat(fallbackQuiz, 'assistant');
                Notifications.warning('Generated practice guidance. AI quiz service is temporarily limited.');
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = originalText;
            }
        }

        function updateRecentQuestions(question) {
            const container = document.getElementById('recent-questions');
            const questions = JSON.parse(Storage.getItem('recent_ai_questions') || '[]');

            // Add new question to the beginning
            questions.unshift({
                question: question,
                timestamp: Date.now()
            });

            // Keep only last 5 questions
            const recentQuestions = questions.slice(0, 5);
            Storage.setItem('recent_ai_questions', JSON.stringify(recentQuestions));

            // Update UI
            if (recentQuestions.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No recent questions</p>';
            } else {
                container.innerHTML = recentQuestions.map(q => `
                <div class="border-bottom pb-2 mb-2 recent-question" onclick="sendQuickMessage('${q.question.replace(/'/g, "\\'")}')">
                    <div class="small fw-medium text-truncate">${Utils.string.truncate(q.question, 50)}</div>
                    <div class="small text-muted">${Utils.date.relative(new Date(q.timestamp))}</div>
                </div>
            `).join('');
            }
        }

        function loadRecentQuestions() {
            const questions = JSON.parse(Storage.getItem('recent_ai_questions') || '[]');
            updateRecentQuestions(''); // This will render existing questions
        }

        // Global functions for onclick handlers
        window.sendQuickMessage = function (message) {
            document.getElementById('message-input').value = message;
            document.getElementById('chat-form').dispatchEvent(new Event('submit'));
        };

        window.copyMessage = async function (button) {
            const messageContent = button.closest('.message-content').querySelector('.message-bubble');
            const text = messageContent.textContent.trim();

            const success = await Utils.browser.copyToClipboard(text);
            if (success) {
                button.innerHTML = '<i class="fas fa-check text-success"></i>';
                setTimeout(() => {
                    button.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
            }
        };

        window.askFollowUp = function (button) {
            const messageContent = button.closest('.message-content').querySelector('.message-bubble').textContent.trim();
            const followUp = `Can you explain more about: "${Utils.string.truncate(messageContent, 50)}"`;
            sendQuickMessage(followUp);
        };

        // Add typing animation styles
        const style = document.createElement('style');
        style.textContent = `
        .typing-animation {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            margin-right: 8px;
        }
        
        .typing-animation span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-animation span:nth-child(1) { animation-delay: -0.32s; }
        .typing-animation span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .recent-question:hover {
            background-color: rgba(59, 130, 246, 0.1);
            cursor: pointer;
            border-radius: 4px;
            padding: 4px;
        }
    `;
        document.head.appendChild(style);
    });
</script>