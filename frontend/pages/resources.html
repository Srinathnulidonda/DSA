<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Resources - DSAPath</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layouts.css">
</head>

<body data-requires-auth="true">
    <div class="app-layout">
        <div id="topbar"></div>
        <div id="sidebar"></div>

        <div class="app-content">
            <main class="app-main">
                <div class="page-header mb-4">
                    <h1 class="page-title">Learning Resources</h1>
                    <p class="page-subtitle">Curated collection of DSA learning materials</p>
                </div>

                <div class="resource-browser">
                    <!-- Filters Sidebar -->
                    <div class="resource-filters">
                        <h6 class="mb-3">Filter Resources</h6>

                        <!-- Type Filter -->
                        <div class="mb-4">
                            <label class="form-label small text-muted">Type</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="text" id="type-text" checked>
                                <label class="form-check-label" for="type-text">
                                    <i class="bi bi-file-text me-1"></i> Articles
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="video" id="type-video" checked>
                                <label class="form-check-label" for="type-video">
                                    <i class="bi bi-play-circle me-1"></i> Videos
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="interactive"
                                    id="type-interactive" checked>
                                <label class="form-check-label" for="type-interactive">
                                    <i class="bi bi-diagram-3 me-1"></i> Interactive
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="practice" id="type-practice"
                                    checked>
                                <label class="form-check-label" for="type-practice">
                                    <i class="bi bi-code me-1"></i> Practice
                                </label>
                            </div>
                        </div>

                        <!-- Topic Filter -->
                        <div class="mb-4">
                            <label class="form-label small text-muted">Topic</label>
                            <select class="form-select form-select-sm" id="topic-filter">
                                <option value="">All Topics</option>
                                <option value="arrays">Arrays & Strings</option>
                                <option value="linkedlists">Linked Lists</option>
                                <option value="stacks">Stacks & Queues</option>
                                <option value="trees">Trees</option>
                                <option value="graphs">Graphs</option>
                                <option value="sorting">Sorting</option>
                                <option value="searching">Searching</option>
                                <option value="dp">Dynamic Programming</option>
                                <option value="algorithms">Algorithms</option>
                            </select>
                        </div>

                        <!-- Source Filter -->
                        <div class="mb-4">
                            <label class="form-label small text-muted">Source</label>
                            <select class="form-select form-select-sm" id="source-filter">
                                <option value="">All Sources</option>
                                <option value="w3schools">W3Schools</option>
                                <option value="geeksforgeeks">GeeksforGeeks</option>
                                <option value="leetcode">LeetCode</option>
                                <option value="youtube">YouTube</option>
                                <option value="visualgo">VisuAlgo</option>
                            </select>
                        </div>

                        <button class="btn btn-sm btn-outline-secondary w-100" onclick="resetFilters()">
                            <i class="bi bi-arrow-clockwise me-1"></i> Reset Filters
                        </button>
                    </div>

                    <!-- Resources Grid -->
                    <div>
                        <!-- Search Bar -->
                        <div class="mb-4">
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <input type="search" class="form-control" placeholder="Search resources..."
                                    id="resource-search" autocomplete="off">
                            </div>
                        </div>

                        <!-- Results Count -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">
                                <span id="results-count">0</span> Resources Found
                            </h5>
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-secondary active"
                                    onclick="setResourceView('grid')">
                                    <i class="bi bi-grid"></i>
                                </button>
                                <button type="button" class="btn btn-outline-secondary"
                                    onclick="setResourceView('list')">
                                    <i class="bi bi-list"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Resources List -->
                        <div id="resources-container" class="resource-list">
                            <!-- Loading skeleton -->
                            <div class="resource-card skeleton-box">
                                <div class="skeleton skeleton-icon mb-3"></div>
                                <div class="skeleton skeleton-title mb-2"></div>
                                <div class="skeleton skeleton-text"></div>
                            </div>
                            <div class="resource-card skeleton-box">
                                <div class="skeleton skeleton-icon mb-3"></div>
                                <div class="skeleton skeleton-title mb-2"></div>
                                <div class="skeleton skeleton-text"></div>
                            </div>
                            <div class="resource-card skeleton-box">
                                <div class="skeleton skeleton-icon mb-3"></div>
                                <div class="skeleton skeleton-title mb-2"></div>
                                <div class="skeleton skeleton-text"></div>
                            </div>
                        </div>

                        <!-- Pagination -->
                        <div id="resources-pagination" class="mt-4"></div>
                    </div>
                </div>
            </main>
        </div>

        <div id="mobile-nav"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/theme.js"></script>
    <script src="/js/notifications.js"></script>
    <script src="/js/lib.js"></script>
    <script src="/js/components.js"></script>
    <script src="/js/loader.js"></script>

    <script>
        let allResources = [];
        let filteredResources = [];
        let currentPage = 1;
        let resourceView = 'grid';
        const perPage = 12;

        async function loadResources() {
            try {
                const response = await api.get('/resources');
                allResources = response.resources;

                // Apply initial filters
                applyFilters();

            } catch (error) {
                notifications.error('Failed to load resources');
                console.error('Resources error:', error);
            }
        }

        function applyFilters() {
            // Get filter values
            const typeFilters = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                typeFilters.push(cb.value);
            });

            const topicFilter = document.getElementById('topic-filter').value;
            const sourceFilter = document.getElementById('source-filter').value;
            const searchQuery = document.getElementById('resource-search').value.toLowerCase();

            // Filter resources
            filteredResources = allResources.filter(resource => {
                // Type filter
                if (typeFilters.length > 0 && !typeFilters.includes(resource.type)) {
                    return false;
                }

                // Topic filter
                if (topicFilter && !resource.id.includes(topicFilter) &&
                    !resource.title.toLowerCase().includes(topicFilter)) {
                    return false;
                }

                // Source filter
                if (sourceFilter && !resource.url.includes(sourceFilter)) {
                    return false;
                }

                // Search filter
                if (searchQuery && !resource.title.toLowerCase().includes(searchQuery) &&
                    !resource.url.toLowerCase().includes(searchQuery)) {
                    return false;
                }

                return true;
            });

            // Update results count
            document.getElementById('results-count').textContent = filteredResources.length;

            // Reset to page 1
            currentPage = 1;

            // Render filtered resources
            renderResources();
        }

        function renderResources() {
            const container = document.getElementById('resources-container');
            container.className = resourceView === 'grid' ? 'resource-list' : 'resource-list-view';

            // Paginate
            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            const pageResources = filteredResources.slice(start, end);

            if (pageResources.length === 0) {
                container.innerHTML = `
                    <div class="empty-state text-center py-5">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                        <h5 class="mt-3">No resources found</h5>
                        <p class="text-muted">Try adjusting your filters or search query</p>
                        <button class="btn btn-primary mt-3" onclick="resetFilters()">
                            Reset Filters
                        </button>
                    </div>
                `;
                document.getElementById('resources-pagination').innerHTML = '';
                return;
            }

            container.innerHTML = pageResources.map(resource => {
                const icon = getResourceIcon(resource.type);
                const sourceInfo = getSourceInfo(resource.url);

                return `
                    <a href="${resource.url}" 
                       target="_blank" 
                       class="resource-card animate-fade-in"
                       onclick="trackResourceClick('${resource.id}')">
                        <div class="resource-card-icon">
                            <i class="bi ${icon}"></i>
                        </div>
                        <h6 class="resource-card-title">${resource.title}</h6>
                        <div class="resource-card-type">${sourceInfo.name} • ${capitalizeFirst(resource.type)}</div>
                        <div class="mt-2">
                            <span class="badge bg-secondary">${sourceInfo.badge}</span>
                        </div>
                    </a>
                `;
            }).join('');

            // Render pagination
            renderPagination();
        }

        function renderPagination() {
            const container = document.getElementById('resources-pagination');
            const totalPages = Math.ceil(filteredResources.length / perPage);

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            new Pagination(container, {
                totalPages: totalPages,
                currentPage: currentPage,
                onChange: (page) => {
                    currentPage = page;
                    renderResources();
                    // Scroll to top
                    document.querySelector('.app-main').scrollTop = 0;
                }
            });
        }

        function getResourceIcon(type) {
            const icons = {
                'text': 'bi-file-text',
                'video': 'bi-play-circle',
                'interactive': 'bi-diagram-3',
                'practice': 'bi-code-square'
            };
            return icons[type] || 'bi-link-45deg';
        }

        function getSourceInfo(url) {
            if (url.includes('w3schools')) return { name: 'W3Schools', badge: 'W3' };
            if (url.includes('geeksforgeeks')) return { name: 'GeeksforGeeks', badge: 'GFG' };
            if (url.includes('leetcode')) return { name: 'LeetCode', badge: 'LC' };
            if (url.includes('youtube')) return { name: 'YouTube', badge: 'YT' };
            if (url.includes('visualgo')) return { name: 'VisuAlgo', badge: 'VA' };
            if (url.includes('programiz')) return { name: 'Programiz', badge: 'PZ' };
            if (url.includes('javatpoint')) return { name: 'JavaTpoint', badge: 'JT' };
            if (url.includes('tutorialspoint')) return { name: 'TutorialsPoint', badge: 'TP' };
            if (url.includes('github')) return { name: 'GitHub', badge: 'GH' };
            return { name: 'External', badge: 'EXT' };
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function setResourceView(view) {
            resourceView = view;
            document.querySelectorAll('.btn-group-sm button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('button').classList.add('active');
            renderResources();
        }

        function resetFilters() {
            // Reset checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });

            // Reset selects
            document.getElementById('topic-filter').value = '';
            document.getElementById('source-filter').value = '';
            document.getElementById('resource-search').value = '';

            // Reapply filters
            applyFilters();
        }

        function trackResourceClick(resourceId) {
            // Track resource usage
            const resource = allResources.find(r => r.id === resourceId);
            if (resource) {
                activity.addRecentResource(resource);
            }
        }

        // Event listeners
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', applyFilters);
        });

        document.getElementById('topic-filter').addEventListener('change', applyFilters);
        document.getElementById('source-filter').addEventListener('change', applyFilters);

        let searchTimeout;
        document.getElementById('resource-search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 300);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadResources();
        });
    </script>

    <style>
        .resource-list {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .resource-list-view {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .resource-list-view .resource-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .resource-list-view .resource-card-icon {
            margin-bottom: 0;
        }

        .resource-card {
            text-decoration: none;
            color: inherit;
            display: block;
            height: 100%;
            transition: all var(--transition-base);
        }

        .resource-card:hover {
            text-decoration: none;
            color: inherit;
            transform: translateY(-2px);
        }

        .resource-card-icon i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .skeleton-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
        }

        @media (max-width: 768px) {
            .resource-browser {
                grid-template-columns: 1fr;
            }

            .resource-filters {
                margin-bottom: 1rem;
                padding: 1rem;
                background: var(--bg-secondary);
                border-radius: var(--radius-lg);
            }
        }
    </style>
</body>

</html>