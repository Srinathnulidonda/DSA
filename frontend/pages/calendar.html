<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - DSA Learning Platform</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/animation.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .fc-event {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fc-event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .calendar-view-btn {
            transition: all 0.3s ease;
        }

        .calendar-view-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .event-completed {
            opacity: 0.7;
            text-decoration: line-through;
        }

        .study-streak-day {
            background: #10b981;
            color: white;
            border-radius: 50%;
        }

        @media (max-width: 768px) {
            .fc-toolbar {
                flex-direction: column;
                gap: 1rem;
            }

            .fc-toolbar-chunk {
                display: flex;
                justify-content: center;
            }

            .fc-button-group {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Desktop Sidebar -->
    <div id="sidebar" class="desktop-only"></div>

    <!-- Mobile Top Bar -->
    <div id="topbar" class="mobile-only"></div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid p-4">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <h1 class="h3 fw-bold mb-2">Study Calendar</h1>
                            <p class="text-muted mb-0">Track your learning schedule and progress</p>
                        </div>
                        <button class="btn btn-primary mt-3 mt-md-0" onclick="showAddEventModal()">
                            <i class="bi bi-plus-circle me-2"></i>Add Event
                        </button>
                    </div>
                </div>
            </div>

            <!-- Calendar Stats -->
            <div class="row mb-4">
                <div class="col-12 col-md-3 mb-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
                                    <i class="bi bi-calendar-check fs-4 text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">This Month</h6>
                                    <h4 class="fw-bold mb-0" id="monthEvents">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-3 mb-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="bg-success bg-opacity-10 rounded-circle p-3 me-3">
                                    <i class="bi bi-check-circle fs-4 text-success"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Completed</h6>
                                    <h4 class="fw-bold mb-0" id="completedEvents">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-3 mb-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="bg-warning bg-opacity-10 rounded-circle p-3 me-3">
                                    <i class="bi bi-clock fs-4 text-warning"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Upcoming</h6>
                                    <h4 class="fw-bold mb-0" id="upcomingEvents">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-3 mb-3">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="bg-info bg-opacity-10 rounded-circle p-3 me-3">
                                    <i class="bi bi-fire fs-4 text-info"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Study Streak</h6>
                                    <h4 class="fw-bold mb-0" id="currentStreak">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar View -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <div class="d-flex gap-2 mb-2 mb-md-0">
                                    <button class="btn btn-sm calendar-view-btn active" data-view="dayGridMonth">
                                        Month
                                    </button>
                                    <button class="btn btn-sm calendar-view-btn" data-view="timeGridWeek">
                                        Week
                                    </button>
                                    <button class="btn btn-sm calendar-view-btn" data-view="timeGridDay">
                                        Day
                                    </button>
                                    <button class="btn btn-sm calendar-view-btn" data-view="listWeek">
                                        List
                                    </button>
                                </div>
                                <div class="d-flex gap-3 flex-wrap">
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: #667eea;"></span>
                                        <span>Study Session</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: #10b981;"></span>
                                        <span>Completed</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: #f59e0b;"></span>
                                        <span>Project</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-dot" style="background: #ef4444;"></span>
                                        <span>Deadline</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="calendar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h5 class="mb-0 fw-semibold">Upcoming Study Sessions</h5>
                        </div>
                        <div class="card-body">
                            <div id="upcomingEventsList">
                                <!-- Events will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div id="mobileNav" class="mobile-only"></div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Study Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addEventForm">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>

                        <div class="mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventStart" class="form-label">Start Date & Time</label>
                                <input type="datetime-local" class="form-control" id="eventStart" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="eventEnd" class="form-label">End Date & Time</label>
                                <input type="datetime-local" class="form-control" id="eventEnd" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="eventType" class="form-label">Event Type</label>
                            <select class="form-select" id="eventType">
                                <option value="study">Study Session</option>
                                <option value="project">Project Work</option>
                                <option value="deadline">Deadline</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="eventColor" class="form-label">Color</label>
                            <input type="color" class="form-control form-control-color" id="eventColor" value="#667eea">
                        </div>

                        <div class="mb-3">
                            <label for="reminderMinutes" class="form-label">Reminder (minutes before)</label>
                            <select class="form-select" id="reminderMinutes">
                                <option value="0">No reminder</option>
                                <option value="15">15 minutes</option>
                                <option value="30" selected>30 minutes</option>
                                <option value="60">1 hour</option>
                                <option value="1440">1 day</option>
                            </select>
                        </div>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="eventRecurring">
                            <label class="form-check-label" for="eventRecurring">
                                Recurring event
                            </label>
                        </div>

                        <div id="recurringOptions" style="display: none;">
                            <div class="mb-3">
                                <label for="recurrenceRule" class="form-label">Repeat</label>
                                <select class="form-select" id="recurrenceRule">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEvent()">Save Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventDetailsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventDetailsTitle">Event Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="eventDetailsBody">
                    <!-- Event details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="deleteEvent()">
                        <i class="bi bi-trash me-1"></i>Delete
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script>
        // API Configuration
        const API_BASE = 'https://dsa-8ko1.onrender.com/api';
        let authToken = null;
        let calendar = null;
        let currentEvent = null;
        let events = [];

        // Initialize calendar
        async function initCalendar() {
            authToken = localStorage.getItem('access_token');

            if (!authToken) {
                window.location.href = '../auth/login.html';
                return;
            }

            // Load components
            await loadComponents();

            // Initialize FullCalendar
            initializeFullCalendar();

            // Load events
            await loadEvents();

            // Load stats
            loadCalendarStats();

            // Setup event listeners
            setupEventListeners();
        }

        // Load reusable components
        async function loadComponents() {
            // Load sidebar
            const sidebarResponse = await fetch('../components/sidebar.html');
            const sidebarHtml = await sidebarResponse.text();
            document.getElementById('sidebar').innerHTML = sidebarHtml;

            // Load topbar
            const topbarResponse = await fetch('../components/topbar.html');
            const topbarHtml = await topbarResponse.text();
            document.getElementById('topbar').innerHTML = topbarHtml;

            // Load mobile nav
            const mobileNavResponse = await fetch('../components/mobile-nav.html');
            const mobileNavHtml = await mobileNavResponse.text();
            document.getElementById('mobileNav').innerHTML = mobileNavHtml;

            // Set active states
            setActiveNavItem('calendar');
        }

        // Set active navigation item
        function setActiveNavItem(page) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === page) {
                    link.classList.add('active');
                }
            });

            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
        }

        // Initialize FullCalendar
        function initializeFullCalendar() {
            const calendarEl = document.getElementById('calendar');

            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                },
                height: 'auto',
                events: [],
                eventClick: function (info) {
                    showEventDetails(info.event);
                },
                dateClick: function (info) {
                    showAddEventModal(info.dateStr);
                },
                eventDidMount: function (info) {
                    // Add tooltips
                    info.el.setAttribute('title', info.event.extendedProps.description || info.event.title);
                },
                dayMaxEvents: true,
                nowIndicator: true,
                businessHours: {
                    daysOfWeek: [1, 2, 3, 4, 5, 6, 0],
                    startTime: '09:00',
                    endTime: '22:00'
                }
            });

            calendar.render();
        }

        // Load events
        async function loadEvents() {
            try {
                const response = await fetch(`${API_BASE}/calendar`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    events = data.events;

                    // Add events to calendar
                    calendar.removeAllEvents();
                    events.forEach(event => {
                        calendar.addEvent({
                            id: event.id,
                            title: event.title,
                            start: event.start_time,
                            end: event.end_time,
                            backgroundColor: event.color || getEventColor(event.event_type),
                            extendedProps: {
                                description: event.description,
                                event_type: event.event_type,
                                recurring: event.recurring,
                                reminder_minutes: event.reminder_minutes
                            }
                        });
                    });

                    // Also load progress data to show completed topics
                    await loadProgressEvents();

                    // Update upcoming events list
                    updateUpcomingEventsList();
                }

            } catch (error) {
                console.error('Error loading events:', error);
                showToast('Failed to load calendar events', 'error');
            }
        }

        // Load progress events
        async function loadProgressEvents() {
            try {
                const progressResponse = await fetch(`${API_BASE}/progress`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (progressResponse.ok) {
                    const progressData = await progressResponse.json();

                    // Add completed topics as events
                    Object.entries(progressData.progress).forEach(([key, progress]) => {
                        if (progress.completed && progress.completion_date) {
                            const match = key.match(/week(\d+)_day(\d+)/);
                            if (match) {
                                calendar.addEvent({
                                    title: `✓ Completed Topic`,
                                    start: progress.completion_date,
                                    backgroundColor: '#10b981',
                                    classNames: ['event-completed'],
                                    extendedProps: {
                                        type: 'progress',
                                        week: match[1],
                                        day: match[2]
                                    }
                                });
                            }
                        }
                    });
                }

            } catch (error) {
                console.error('Error loading progress events:', error);
            }
        }

        // Get event color based on type
        function getEventColor(type) {
            const colors = {
                'study': '#667eea',
                'project': '#f59e0b',
                'deadline': '#ef4444'
            };
            return colors[type] || '#667eea';
        }

        // Load calendar stats
        async function loadCalendarStats() {
            try {
                // Get current month events
                const now = new Date();
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);

                let monthEvents = 0;
                let completedEvents = 0;
                let upcomingEvents = 0;

                events.forEach(event => {
                    const eventStart = new Date(event.start_time);

                    if (eventStart >= monthStart && eventStart <= monthEnd) {
                        monthEvents++;
                    }

                    if (eventStart < now) {
                        completedEvents++;
                    } else {
                        upcomingEvents++;
                    }
                });

                document.getElementById('monthEvents').textContent = monthEvents;
                document.getElementById('completedEvents').textContent = completedEvents;
                document.getElementById('upcomingEvents').textContent = upcomingEvents;

                // Load streak
                const streakResponse = await fetch(`${API_BASE}/streaks`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (streakResponse.ok) {
                    const streakData = await streakResponse.json();
                    document.getElementById('currentStreak').textContent = streakData.current_streak;
                }

            } catch (error) {
                console.error('Error loading calendar stats:', error);
            }
        }

        // Update upcoming events list
        function updateUpcomingEventsList() {
            const container = document.getElementById('upcomingEventsList');
            const now = new Date();

            // Filter and sort upcoming events
            const upcoming = events
                .filter(event => new Date(event.start_time) > now)
                .sort((a, b) => new Date(a.start_time) - new Date(b.start_time))
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No upcoming events</p>';
                return;
            }

            container.innerHTML = upcoming.map(event => {
                const startDate = new Date(event.start_time);
                const endDate = new Date(event.end_time);

                return `
                    <div class="d-flex align-items-center mb-3 p-3 bg-light rounded">
                        <div class="me-3">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-3">
                                <i class="bi bi-calendar-event text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${event.title}</h6>
                            <p class="text-muted mb-0 small">
                                ${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - 
                                ${endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                            </p>
                        </div>
                        <div>
                            <span class="badge bg-${getEventBadgeColor(event.event_type)}">${event.event_type}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get event badge color
        function getEventBadgeColor(type) {
            const colors = {
                'study': 'primary',
                'project': 'warning',
                'deadline': 'danger'
            };
            return colors[type] || 'secondary';
        }

        // Show add event modal
        function showAddEventModal(dateStr = null) {
            // Reset form
            document.getElementById('addEventForm').reset();

            // Set default date if provided
            if (dateStr) {
                const date = new Date(dateStr);
                const localDate = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
                const dateTimeStr = localDate.toISOString().slice(0, 16);
                document.getElementById('eventStart').value = dateTimeStr;

                const endDate = new Date(localDate);
                endDate.setHours(endDate.getHours() + 1);
                document.getElementById('eventEnd').value = endDate.toISOString().slice(0, 16);
            }

            const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
            modal.show();
        }

        // Save event
        async function saveEvent() {
            const form = document.getElementById('addEventForm');

            const eventData = {
                title: form.eventTitle.value,
                description: form.eventDescription.value,
                start_time: new Date(form.eventStart.value).toISOString(),
                end_time: new Date(form.eventEnd.value).toISOString(),
                event_type: form.eventType.value,
                color: form.eventColor.value,
                reminder_minutes: parseInt(form.reminderMinutes.value),
                recurring: form.eventRecurring.checked,
                recurrence_rule: form.eventRecurring.checked ? form.recurrenceRule.value : null
            };

            try {
                const response = await fetch(`${API_BASE}/calendar`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('addEventModal')).hide();

                    // Reload events
                    await loadEvents();
                    loadCalendarStats();

                    showToast('Event created successfully', 'success');
                } else {
                    showToast('Failed to create event', 'error');
                }

            } catch (error) {
                console.error('Error saving event:', error);
                showToast('Failed to create event', 'error');
            }
        }

        // Show event details
        function showEventDetails(event) {
            currentEvent = event;

            document.getElementById('eventDetailsTitle').textContent = event.title;

            const modalBody = document.getElementById('eventDetailsBody');
            const startDate = new Date(event.start);
            const endDate = new Date(event.end || event.start);

            modalBody.innerHTML = `
                <div class="mb-3">
                    <h6 class="fw-semibold mb-2">Date & Time</h6>
                    <p>${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} - 
                       ${endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                </div>
                
                ${event.extendedProps.description ? `
                    <div class="mb-3">
                        <h6 class="fw-semibold mb-2">Description</h6>
                        <p>${event.extendedProps.description}</p>
                    </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6 class="fw-semibold mb-2">Type</h6>
                    <span class="badge bg-${getEventBadgeColor(event.extendedProps.event_type)}">
                        ${event.extendedProps.event_type}
                    </span>
                </div>
                
                ${event.extendedProps.reminder_minutes > 0 ? `
                    <div class="mb-3">
                        <h6 class="fw-semibold mb-2">Reminder</h6>
                        <p>${event.extendedProps.reminder_minutes} minutes before</p>
                    </div>
                ` : ''}
                
                ${event.extendedProps.recurring ? `
                    <div class="mb-3">
                        <h6 class="fw-semibold mb-2">Recurring</h6>
                        <p><i class="bi bi-arrow-repeat me-1"></i>This is a recurring event</p>
                    </div>
                ` : ''}
            `;

            const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
            modal.show();
        }

        // Delete event
        async function deleteEvent() {
            if (!currentEvent) return;

            if (!confirm('Are you sure you want to delete this event?')) return;

            try {
                const response = await fetch(`${API_BASE}/calendar/${currentEvent.id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('eventDetailsModal')).hide();

                    // Remove from calendar
                    currentEvent.remove();

                    // Reload stats
                    await loadEvents();
                    loadCalendarStats();

                    showToast('Event deleted successfully', 'success');
                } else {
                    showToast('Failed to delete event', 'error');
                }

            } catch (error) {
                console.error('Error deleting event:', error);
                showToast('Failed to delete event', 'error');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // View buttons
            document.querySelectorAll('.calendar-view-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.calendar-view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    calendar.changeView(this.dataset.view);
                });
            });

            // Recurring checkbox
            document.getElementById('eventRecurring').addEventListener('change', function () {
                document.getElementById('recurringOptions').style.display = this.checked ? 'block' : 'none';
            });
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastHtml = `
                <div class="toast align-items-center text-bg-${type} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;

            const toastContainer = document.querySelector('.toast-container') || createToastContainer();
            const toastElement = document.createElement('div');
            toastElement.innerHTML = toastHtml;
            toastContainer.appendChild(toastElement.firstElementChild);

            const toast = new bootstrap.Toast(toastElement.firstElementChild);
            toast.show();
        }

        // Create toast container
        function createToastContainer() {
            const container = document.createElement('div');
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(container);
            return container;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initCalendar);
    </script>
</body>

</html>