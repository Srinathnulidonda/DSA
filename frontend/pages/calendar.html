<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Calendar - DSA Path</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/components.css" rel="stylesheet">
    <link href="../css/animation.css" rel="stylesheet">
    <link href="../css/responsive.css" rel="stylesheet">
</head>

<body>
    <div class="main-layout">
        <!-- Include Sidebar -->
        <div id="sidebar-container"></div>

        <div class="main-content">
            <!-- Include Topbar -->
            <div id="topbar-container"></div>

            <div class="content-area">
                <!-- Header Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div
                            class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
                            <div class="animate-fadeInLeft">
                                <h2 class="fw-bold text-dark mb-1">Study Calendar</h2>
                                <p class="text-muted mb-0">Track your daily learning progress</p>
                            </div>
                            <div class="d-flex gap-2 animate-fadeInRight">
                                <button class="btn btn-outline-primary btn-sm" onclick="goToToday()">
                                    <i class="fas fa-calendar-day me-1"></i>Today
                                </button>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-secondary btn-sm" onclick="changeMonth(-1)">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="changeMonth(1)">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <div class="dropdown">
                                    <button class="btn btn-outline-info btn-sm dropdown-toggle"
                                        data-bs-toggle="dropdown">
                                        <i class="fas fa-eye me-1"></i>View
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="setCalendarView('month')">Month
                                                View</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setCalendarView('week')">Week
                                                View</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Stats -->
                <div class="row mb-4">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stats-card text-center hover-lift animate-fadeInUp">
                            <i class="fas fa-calendar-check text-success fs-2 mb-2"></i>
                            <h4 class="fw-bold text-success mb-1" id="days-completed">0</h4>
                            <small class="text-muted">Days Completed</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stats-card text-center hover-lift animate-fadeInUp animation-delay-100">
                            <i class="fas fa-fire text-warning fs-2 mb-2"></i>
                            <h4 class="fw-bold text-warning mb-1" id="current-streak">0</h4>
                            <small class="text-muted">Current Streak</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stats-card text-center hover-lift animate-fadeInUp animation-delay-200">
                            <i class="fas fa-target text-primary fs-2 mb-2"></i>
                            <h4 class="fw-bold text-primary mb-1" id="month-goal">0%</h4>
                            <small class="text-muted">Month Goal</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stats-card text-center hover-lift animate-fadeInUp animation-delay-300">
                            <i class="fas fa-clock text-info fs-2 mb-2"></i>
                            <h4 class="fw-bold text-info mb-1" id="total-time">0h</h4>
                            <small class="text-muted">Total Time</small>
                        </div>
                    </div>
                </div>

                <!-- Calendar Navigation -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4 class="fw-bold mb-0" id="calendar-title">Loading...</h4>
                                <div class="d-flex gap-2">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="d-flex align-items-center gap-1">
                                            <div class="calendar-legend completed"></div>
                                            <small class="text-muted">Completed</small>
                                        </div>
                                        <div class="d-flex align-items-center gap-1">
                                            <div class="calendar-legend partial"></div>
                                            <small class="text-muted">Partial</small>
                                        </div>
                                        <div class="d-flex align-items-center gap-1">
                                            <div class="calendar-legend today"></div>
                                            <small class="text-muted">Today</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Grid -->
                <div class="row">
                    <div class="col-12">
                        <div class="stats-card p-0 animate-fadeInUp">
                            <div id="calendar-container">
                                <div class="text-center py-5">
                                    <div class="loading-spinner mx-auto mb-3"></div>
                                    <p class="text-muted">Loading calendar...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Summary -->
                <div class="row mt-4" id="weekly-summary" style="display: none;">
                    <div class="col-12">
                        <div class="stats-card animate-fadeInUp">
                            <h5 class="fw-bold mb-3">
                                <i class="fas fa-chart-bar me-2"></i>Weekly Progress Summary
                            </h5>
                            <div id="weekly-progress-chart">
                                <!-- Weekly progress will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Include Mobile Navigation -->
        <div id="mobile-nav-container"></div>
    </div>

    <!-- Day Detail Modal -->
    <div class="modal fade" id="dayDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title" id="dayModalTitle">Day Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body modal-body-custom" id="dayModalBody">
                    <!-- Day details will be loaded here -->
                </div>
                <div class="modal-footer modal-footer-custom">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="startStudyBtn" onclick="startStudySession()">
                        <i class="fas fa-play me-1"></i>Start Study Session
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://dsa-backend-gj8n.onrender.com';
        let currentDate = new Date();
        let calendarView = 'month';
        let progressData = {};
        let roadmapData = [];
        let selectedDay = null;

        document.addEventListener('DOMContentLoaded', function () {
            checkAuth();
            loadComponents();
            initializeCalendar();
        });

        function checkAuth() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
        }

        async function loadComponents() {
            try {
                // Load sidebar
                const sidebarResponse = await fetch('../components/sidebar.html');
                const sidebarHtml = await sidebarResponse.text();
                document.getElementById('sidebar-container').innerHTML = sidebarHtml;

                // Load topbar
                const topbarResponse = await fetch('../components/topbar.html');
                const topbarHtml = await topbarResponse.text();
                document.getElementById('topbar-container').innerHTML = topbarHtml;

                // Load mobile nav
                const mobileNavResponse = await fetch('../components/mobile-nav.html');
                const mobileNavHtml = await mobileNavResponse.text();
                document.getElementById('mobile-nav-container').innerHTML = mobileNavHtml;

                // Execute scripts in loaded components
                setActiveNavItem();
                setActiveMobileNavItem();
                updatePageTitle();
                loadUserData();
            } catch (error) {
                console.error('Error loading components:', error);
            }
        }

        async function initializeCalendar() {
            try {
                await Promise.all([
                    loadProgressData(),
                    loadRoadmapData()
                ]);

                renderCalendar();
                updateCalendarStats();
                updateCalendarTitle();
            } catch (error) {
                console.error('Calendar initialization error:', error);
                showErrorMessage('Failed to load calendar data');
            }
        }

        async function loadProgressData() {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE}/progress`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    progressData = data.progress;
                } else if (response.status === 401) {
                    localStorage.clear();
                    window.location.href = '/login';
                } else {
                    progressData = {};
                }
            } catch (error) {
                console.error('Error loading progress:', error);
                progressData = {};
            }
        }

        async function loadRoadmapData() {
            try {
                const response = await fetch(`${API_BASE}/roadmap`);
                if (response.ok) {
                    const data = await response.json();
                    roadmapData = data.roadmap;
                } else {
                    roadmapData = [];
                }
            } catch (error) {
                console.error('Error loading roadmap:', error);
                roadmapData = [];
            }
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-container');

            if (calendarView === 'month') {
                renderMonthView(container);
            } else {
                renderWeekView(container);
            }
        }

        function renderMonthView(container) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            let html = `
                <div class="calendar-header p-3 border-bottom">
                    <div class="row g-0">
                        ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
                `<div class="col text-center fw-semibold text-muted py-2">${day}</div>`
            ).join('')}
                    </div>
                </div>
                <div class="calendar-body">
            `;

            let currentWeekStart = new Date(startDate);

            while (currentWeekStart <= lastDay || currentWeekStart.getMonth() === month) {
                html += '<div class="row g-0">';

                for (let i = 0; i < 7; i++) {
                    const cellDate = new Date(currentWeekStart);
                    cellDate.setDate(cellDate.getDate() + i);

                    const isCurrentMonth = cellDate.getMonth() === month;
                    const isToday = cellDate.toDateString() === today.toDateString();
                    const dayProgress = getDayProgress(cellDate);

                    let cellClass = 'calendar-day';
                    if (!isCurrentMonth) cellClass += ' other-month';
                    if (isToday) cellClass += ' today';
                    if (dayProgress.completed) cellClass += ' completed';
                    else if (dayProgress.partial) cellClass += ' partial';

                    html += `
                        <div class="col">
                            <div class="${cellClass}" onclick="showDayDetail('${cellDate.toISOString()}')">
                                <div class="day-number">${cellDate.getDate()}</div>
                                ${renderDayContent(cellDate, dayProgress)}
                            </div>
                        </div>
                    `;
                }

                html += '</div>';
                currentWeekStart.setDate(currentWeekStart.getDate() + 7);

                if (currentWeekStart.getMonth() > month && currentWeekStart.getDate() > 7) {
                    break;
                }
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function renderWeekView(container) {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const date = currentDate.getDate();

            // Get start of week (Sunday)
            const startOfWeek = new Date(year, month, date);
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());

            let html = `
                <div class="calendar-header p-3 border-bottom">
                    <div class="row g-0">
                        ${['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].map((day, index) => {
                const dayDate = new Date(startOfWeek);
                dayDate.setDate(dayDate.getDate() + index);
                const isToday = dayDate.toDateString() === new Date().toDateString();

                return `
                                <div class="col text-center py-3 ${isToday ? 'bg-primary text-white rounded' : ''}">
                                    <div class="fw-semibold">${day}</div>
                                    <div class="fs-4 fw-bold">${dayDate.getDate()}</div>
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>
                <div class="calendar-body p-3">
                    <div class="row g-3">
            `;

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(startOfWeek);
                dayDate.setDate(dayDate.getDate() + i);
                const dayProgress = getDayProgress(dayDate);
                const activities = getDayActivities(dayDate);

                html += `
                    <div class="col">
                        <div class="week-day-card h-100 p-3 border rounded hover-lift" onclick="showDayDetail('${dayDate.toISOString()}')">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <h6 class="fw-bold mb-0">${dayDate.toLocaleDateString('en-US', { weekday: 'short' })}</h6>
                                ${dayProgress.completed ? '<i class="fas fa-check-circle text-success"></i>' :
                        dayProgress.partial ? '<i class="fas fa-clock text-warning"></i>' :
                            '<i class="fas fa-circle text-light"></i>'}
                            </div>
                            <div class="activities">
                                ${activities.map(activity => `
                                    <div class="activity-item mb-1 p-2 bg-light rounded">
                                        <small class="fw-semibold">${activity.topic}</small>
                                        <div class="text-muted" style="font-size: 0.75rem;">${activity.time} min</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div></div>';
            container.innerHTML = html;
        }

        function renderDayContent(date, dayProgress) {
            const activities = getDayActivities(date);

            if (activities.length === 0) {
                return '<div class="day-content"></div>';
            }

            let html = '<div class="day-content">';

            // Show up to 3 activities
            activities.slice(0, 3).forEach(activity => {
                html += `
                    <div class="activity-dot ${activity.completed ? 'completed' : ''}" 
                         title="${activity.topic}"></div>
                `;
            });

            if (activities.length > 3) {
                html += `<div class="activity-more">+${activities.length - 3}</div>`;
            }

            html += '</div>';
            return html;
        }

        function getDayProgress(date) {
            const activities = getDayActivities(date);
            if (activities.length === 0) {
                return { completed: false, partial: false };
            }

            const completedCount = activities.filter(a => a.completed).length;
            const completed = completedCount === activities.length;
            const partial = completedCount > 0 && completedCount < activities.length;

            return { completed, partial };
        }

        function getDayActivities(date) {
            const activities = [];
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });

            roadmapData.forEach(week => {
                const dayData = week.days.find(d => d.day === dayName);
                if (dayData) {
                    const weekProgress = progressData[week.week] || {};
                    const dayProgress = weekProgress[dayName] || { completed: false };

                    activities.push({
                        week: week.week,
                        day: dayName,
                        topic: dayData.topic,
                        time: dayData.time_estimate,
                        completed: dayProgress.completed,
                        activities: dayData.activities
                    });
                }
            });

            return activities;
        }

        function updateCalendarStats() {
            let totalCompleted = 0;
            let totalDays = 0;
            let totalTime = 0;
            let currentStreakCount = 0;

            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();

            // Calculate stats for current month
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);

            for (let date = new Date(firstDay); date <= lastDay; date.setDate(date.getDate() + 1)) {
                const activities = getDayActivities(date);
                if (activities.length > 0) {
                    totalDays++;
                    const completedActivities = activities.filter(a => a.completed);
                    if (completedActivities.length === activities.length) {
                        totalCompleted++;
                    }
                    totalTime += activities.reduce((sum, a) => sum + (a.completed ? a.time : 0), 0);
                }
            }

            // Calculate current streak
            const today = new Date();
            let streakDate = new Date(today);
            while (streakDate >= firstDay) {
                const activities = getDayActivities(streakDate);
                if (activities.length > 0) {
                    const allCompleted = activities.every(a => a.completed);
                    if (allCompleted) {
                        currentStreakCount++;
                    } else {
                        break;
                    }
                }
                streakDate.setDate(streakDate.getDate() - 1);
            }

            const monthGoal = totalDays > 0 ? (totalCompleted / totalDays) * 100 : 0;

            // Update UI
            document.getElementById('days-completed').textContent = totalCompleted;
            document.getElementById('current-streak').textContent = currentStreakCount;
            document.getElementById('month-goal').textContent = `${Math.round(monthGoal)}%`;
            document.getElementById('total-time').textContent = `${Math.round(totalTime / 60)}h`;
        }

        function updateCalendarTitle() {
            const title = document.getElementById('calendar-title');
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            if (calendarView === 'month') {
                title.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            } else {
                const startOfWeek = new Date(currentDate);
                startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);

                title.textContent = `${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;
            }
        }

        function showDayDetail(dateString) {
            const date = new Date(dateString);
            selectedDay = date;
            const activities = getDayActivities(date);

            const modal = new bootstrap.Modal(document.getElementById('dayDetailModal'));
            const title = document.getElementById('dayModalTitle');
            const body = document.getElementById('dayModalBody');

            title.textContent = date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            if (activities.length === 0) {
                body.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times text-muted fs-1 mb-3"></i>
                        <h5 class="text-muted">No Activities Scheduled</h5>
                        <p class="text-muted">This day doesn't have any learning activities planned.</p>
                    </div>
                `;
                document.getElementById('startStudyBtn').style.display = 'none';
            } else {
                let html = '<div class="activity-list">';

                activities.forEach(activity => {
                    html += `
                        <div class="activity-card mb-3 p-3 border rounded ${activity.completed ? 'bg-success bg-opacity-10 border-success' : ''}">
                            <div class="d-flex align-items-start">
                                <div class="completion-toggle ${activity.completed ? 'completed' : ''} me-3" 
                                     onclick="toggleActivityCompletion(${activity.week}, '${activity.day}')">
                                    <i class="fas fa-check" style="display: ${activity.completed ? 'block' : 'none'};"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-1">Week ${activity.week}: ${activity.topic}</h6>
                                    <p class="text-muted mb-2">${activity.activities}</p>
                                    <div class="d-flex align-items-center gap-3">
                                        <small class="text-muted">
                                            <i class="fas fa-clock me-1"></i>
                                            ${activity.time} minutes
                                        </small>
                                        ${activity.completed ? `
                                            <small class="text-success">
                                                <i class="fas fa-check-circle me-1"></i>
                                                Completed
                                            </small>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                body.innerHTML = html;
                document.getElementById('startStudyBtn').style.display = 'block';
            }

            modal.show();
        }

        async function toggleActivityCompletion(week, day) {
            const toggle = event.currentTarget;
            const icon = toggle.querySelector('i');
            const card = toggle.closest('.activity-card');
            const isCompleted = toggle.classList.contains('completed');

            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE}/progress`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        week: week,
                        day: day,
                        completed: !isCompleted
                    })
                });

                if (response.ok) {
                    toggle.classList.toggle('completed');
                    card.classList.toggle('bg-success');
                    card.classList.toggle('bg-opacity-10');
                    card.classList.toggle('border-success');

                    if (toggle.classList.contains('completed')) {
                        icon.style.display = 'block';
                        // Update completion text
                        const completionText = card.querySelector('small.text-success');
                        if (!completionText) {
                            const newText = document.createElement('small');
                            newText.className = 'text-success';
                            newText.innerHTML = '<i class="fas fa-check-circle me-1"></i>Completed';
                            card.querySelector('.d-flex.align-items-center.gap-3').appendChild(newText);
                        }
                    } else {
                        icon.style.display = 'none';
                        const completionText = card.querySelector('small.text-success');
                        if (completionText) {
                            completionText.remove();
                        }
                    }

                    // Update progress data
                    if (!progressData[week]) progressData[week] = {};
                    progressData[week][day] = {
                        completed: !isCompleted,
                        time_spent: progressData[week][day]?.time_spent || 0
                    };

                    // Refresh calendar
                    renderCalendar();
                    updateCalendarStats();
                }
            } catch (error) {
                console.error('Error toggling completion:', error);
                showErrorToast('Failed to update progress');
            }
        }

        function startStudySession() {
            if (!selectedDay) return;

            const activities = getDayActivities(selectedDay);
            const incompleteActivity = activities.find(a => !a.completed);

            if (incompleteActivity) {
                localStorage.setItem('current_study_session', JSON.stringify({
                    week: incompleteActivity.week,
                    day: incompleteActivity.day,
                    topic: incompleteActivity.topic,
                    startTime: new Date().toISOString()
                }));

                window.location.href = '/roadmap';
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
            updateCalendarStats();
            updateCalendarTitle();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
            updateCalendarStats();
            updateCalendarTitle();
        }

        function setCalendarView(view) {
            calendarView = view;
            renderCalendar();
            updateCalendarTitle();

            if (view === 'week') {
                document.getElementById('weekly-summary').style.display = 'block';
                renderWeeklyProgress();
            } else {
                document.getElementById('weekly-summary').style.display = 'none';
            }
        }

        function renderWeeklyProgress() {
            const container = document.getElementById('weekly-progress-chart');
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            let html = '<div class="row g-2">';

            days.forEach((day, index) => {
                const dayDate = new Date(currentDate);
                dayDate.setDate(dayDate.getDate() - dayDate.getDay() + index);
                const activities = getDayActivities(dayDate);
                const completedActivities = activities.filter(a => a.completed).length;
                const totalActivities = activities.length;
                const percentage = totalActivities > 0 ? (completedActivities / totalActivities) * 100 : 0;

                html += `
                    <div class="col">
                        <div class="text-center">
                            <div class="progress-bar-vertical mb-2" style="height: 100px;">
                                <div class="progress-fill-vertical bg-primary" 
                                     style="height: ${percentage}%"></div>
                            </div>
                            <small class="fw-semibold">${day}</small>
                            <br>
                            <small class="text-muted">${Math.round(percentage)}%</small>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function showErrorToast(message) {
            const toast = document.createElement('div');
            toast.className = 'position-fixed top-0 end-0 p-3';
            toast.style.zIndex = '1060';
            toast.innerHTML = `
                <div class="toast show animate-slideInDown" role="alert">
                    <div class="toast-header bg-danger text-white">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <strong class="me-auto">Error</strong>
                        <button type="button" class="btn-close btn-close-white" onclick="this.closest('.toast').parentElement.remove()"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function showErrorMessage(message) {
            const container = document.getElementById('calendar-container');
            container.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-exclamation-triangle text-warning fs-1 mb-3"></i>
                    <h4 class="text-muted mb-3">Unable to Load Calendar</h4>
                    <p class="text-muted mb-4">${message}</p>
                    <button class="btn btn-primary" onclick="initializeCalendar()">
                        <i class="fas fa-redo me-2"></i>Try Again
                    </button>
                </div>
            `;
        }
    </script>

    <style>
        .calendar-day {
            min-height: 120px;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .calendar-day:hover {
            background-color: #f8fafc;
            border-color: #3b82f6;
        }

        .calendar-day.today {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .calendar-day.completed {
            background-color: #dcfce7;
            border-color: #10b981;
        }

        .calendar-day.partial {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background-color: #f9fafb;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .day-content {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }

        .activity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #e5e7eb;
        }

        .activity-dot.completed {
            background-color: #10b981;
        }

        .activity-more {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .calendar-legend {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .calendar-legend.completed {
            background-color: #dcfce7;
            border: 1px solid #10b981;
        }

        .calendar-legend.partial {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
        }

        .calendar-legend.today {
            background-color: #dbeafe;
            border: 1px solid #3b82f6;
        }

        .week-day-card {
            min-height: 200px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .week-day-card:hover {
            border-color: #3b82f6 !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .activity-item {
            border-left: 3px solid #3b82f6;
        }

        .progress-bar-vertical {
            width: 20px;
            background-color: #e5e7eb;
            border-radius: 10px;
            position: relative;
            margin: 0 auto;
        }

        .progress-fill-vertical {
            position: absolute;
            bottom: 0;
            width: 100%;
            border-radius: 10px;
            transition: height 0.3s ease;
        }

        @media (max-width: 768px) {
            .calendar-day {
                min-height: 80px;
                padding: 0.25rem;
            }

            .day-number {
                font-size: 0.9rem;
            }

            .week-day-card {
                min-height: 150px;
            }
        }
    </style>
</body>

</html>